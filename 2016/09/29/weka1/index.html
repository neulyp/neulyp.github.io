<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>机器学习weka（一） | lyp's blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">机器学习weka（一）</h1><a id="logo" href="/.">lyp's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">机器学习weka（一）</h1><div class="post-meta">Sep 29, 2016<span> | </span><span class="category"><a href="/categories/机器学习/">机器学习</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>###机器学习weka（一）<br><a id="more"></a></p>
<p>##1.Instances</p>
<p>Instances对象实例化后，就存储了所有数据，同时也附带了很多数据属性，简单来说，你可以认为Instances就像一个电子表格，存储了你所加载的数据。 </p>
<p>Instances实例化有很多方式，在这里我介绍三种方式：<br>1.通过文件加载</p>
<pre><code>Instances(java.io.Reader reader) 
Reads an ARFF file from a reader, and assigns a weight of one to each instance.

Instances(java.io.Reader reader, int capacity) 
Deprecated. instead of using this method in conjunction with the readInstance(Reader) method, one should use the ArffLoader or DataSource class instead.

Instances data = new Instances( new BufferedReader(new FileReader(&quot;/Path/data.arff&quot;)));
</code></pre><p>2.使用DataSource从文件中加载数据 </p>
<pre><code>DataSource source = new DataSource(&quot;/some/where/data.arff&quot;);
Instances data = source.getDataSet();
</code></pre><p>3.从数据库实例化Instances对象</p>
<pre><code>InstanceQuery query= new InstanceQuery();
query.setDebug(true);
query.setUsername(&quot;C##TEST&quot;);
query.setPassword(&quot;test&quot;);
query.setDatabaseURL(&quot;jdbc:oracle:thin:@127.0.0.1:1521:ORCL&quot;);
String sql=&quot;SELECT * FROM (SELECT MDI_READING , MDI_TS from M_FS_DB_INTERVAL where  CST_ID= 5695 ) where rownum &lt; 10000&quot;;
query.setQuery(sql);
Instances train=query.retrieveInstances();
</code></pre><p>4.自己构造一个instances</p>
<pre><code>Creates an empty set of instances. Uses the given attribute information. Sets the capacity of the set of instances to 0 if its negative. Given attribute information must not be changed after this constructor has been used.Parameters:name the name of the relationattInfo the attribute informationcapacity the capacity of the setThrows:IllegalArgumentException - if attribute names are not unique

Instances(java.lang.String name, java.util.ArrayList&lt;Attribute&gt; attInfo, int capacity) 
Creates an empty set of instances.
</code></pre><p>根据构造方法我们需要创建一个attInfo对象。</p>
<pre><code>ArrayList&lt;Attribute&gt; atts = new ArrayList&lt;Attribute&gt;();
Attribute attribute1 = new Attribute(&quot;ID&quot;);
Attribute attribute2 = new Attribute(&quot;District&quot;);
Attribute attribute3 = new Attribute(&quot;CountryCode&quot;);
Attribute attribute4 = new Attribute(&quot;Population&quot;);
atts.add(attribute1);
atts.add(attribute2);
atts.add(attribute3);
atts.add(attribute4);
</code></pre><p>构建instances对象</p>
<pre><code>Instances df = new Instances(&quot;Data&quot;, atts, 0);
</code></pre><p>构建instance对象</p>
<pre><code>Create empty instance with three attribute values 
Instance inst = new DenseInstance(3); 
// Set instance&apos;s values for the attributes &quot;length&quot;, &quot;weight&quot;, and &quot;position&quot;
inst.setValue(length, 5.3); 
inst.setValue(weight, 300); 
inst.setValue(position, &quot;first&quot;); 
// Set instance&apos;s dataset to be the dataset &quot;race&quot; 
inst.setDataset(instances); 
</code></pre><p>instances对象添加instance值</p>
<pre><code>instances.add(inst);
</code></pre><p>##2.Attribute</p>
<p>1.介绍</p>
<p>attribute指的是Weka中数据的属性，一般就是表明数据集信息，数据每一列的性质等。之前讲过的Weka数据格式ARFF其实头信息包含的就是数据的Attribute信息。之前讲的Weka的数据存储方式Instances也有Attribute属性。<br>Attribute属性主要分以下几类:</p>
<pre><code>numeric: This type of attribute represents a floating-point number. 
         就是代表连续的，浮点数变量，如气温。
nominal: This type of attribute represents a fixed set of nominal values. 
         指的是离散的，刻意被划分为几类的变量，如户口类型。
string: This type of attribute represents a dynamically expanding set of nominal values. Usually used in text classification. 
         指的该列内容是文本，一般用于文本挖掘。
date: This type of attribute represents a date, internally represented as floating-point number storing the milliseconds since January 1, 1970, 00:00:00 GMT. The string representation of the date must be ISO-8601 compliant, the default is yyyy-MM-dd&apos;T&apos;HH:mm:ss. 
         指的该列数据代表日期，要按照规范格式写。
relational: This type of attribute can contain other attributes and is, e.g., used for representing Multi-Instance data. (Multi-Instance data consists of a nominal attribute containing the bag-id, then a relational attribute with all the attributes of the bag, and finally the class attribute.) 
    用来实现其他类型的数据。
</code></pre><p>2.attribute的创建</p>
<pre><code>// Create numeric attributes &quot;length&quot; and &quot;weight&quot; 
Attribute length = new Attribute(&quot;length&quot;); 
Attribute weight = new Attribute(&quot;weight&quot;); 
// Create list to hold nominal values &quot;first&quot;, &quot;second&quot;, &quot;third&quot; 
List my_nominal_values = new ArrayList(3); 
my_nominal_values.add(&quot;first&quot;); 
my_nominal_values.add(&quot;second&quot;); 
my_nominal_values.add(&quot;third&quot;); 
// Create nominal attribute &quot;position&quot; 
Attribute position = new Attribute(&quot;position&quot;, my_nominal_values);
</code></pre><p>##3.Filter（数据预处理）</p>
<p>1.什么是数据预处理？</p>
<p>加载完毕数据集后，还是不能直接进行数据挖掘模型的训练和学习，必须要进行数据预处理，数据预处理一般指的是以下四个方面：数据清理，数据集成，数据变换，数据归约等。</p>
<ul>
<li><p>①数据清理<br>数据清理例程通过填写缺失的值、光滑噪声数据、识别或删除离群点并解决不一致性来“清理”数据。主要是达到如下目标：格式标准化，异常数据清除，错误纠正，重复数据的清除。 </p>
</li>
<li><p>②数据集成<br>数据集成例程将多个数据源中的数据结合起来并统一存储，建立数据仓库的过程实际上就是数据集成。 </p>
</li>
<li><p>③数据变换<br>通过平滑聚集，数据概化，规范化等方式将数据转换成适用于数据挖掘的形式。 </p>
</li>
<li><p>④数据归约<br>数据挖掘时往往数据量非常大，在少量数据上进行挖掘分析需要很长的时间，数据归约技术可以用来得到数据集的归约表示，它小得多，但仍然接近于保持原数据的完整性，并结果与归约前结果相同或几乎相同。<br>这些预处理都可以使用Weka的Filter来实现。Weka的Filter作用是将一个Instances输入后，通过特定的数据清洗过程，将清洗好的Instances输出，也就是说，Filter处理的维度是在Instances层面上进行的。你也可以通过Filter的组合来实现复杂的数据处理。</p>
</li>
</ul>
<p>Filter提供的功能<br>FIlter功能还是比较强大的，但是Filter分为非监督学习和监督学习两种过滤器，分别属于weka.filters.unsupervised.attribute和weka.filters.unsupervised.attribute，至于监督学习和非监督学习，简单理解就是看输入数据是否有标签（label）。输入数据有标签，则为有监督学习，没标签则为无监督学习。这两种方式下的过滤器是不一样的，使用时一定要注意。<br>非监督学习包下的方法比较多，先讲解一下&gt; weka.filters.unsupervised.attribute主要方法的含义： </p>
<blockquote>
<p>1.Add<br>为数据库添加一个新的属性，新的属性将会包含所有缺失值。</p>
<p>2.AddExpression<br>新增一个属性，该属性由现有属性通过设定的表达式计算得出。支持+, -, *, /, ^, log, abs, cos, exp, sqrt, floor, ceil, rint, tan, sin。现有属性由a+索引值构成。 </p>
<p>3.AddNoise<br>只对名义属性有效，依照一定比例修改值。 </p>
<p>4.Center<br>将数值化属性的平均化为0。 </p>
<p>5.ChangeDateFormat<br>修改数据格式 </p>
<p>6.Discretize<br>简单划分的离散化处理。参数： </p>
<p>7.MathExpression<br>功能和AddExpression类似，不过支持的运算更多，特别是MAX和MIN的支持特别有用。所有支持运算符如下：+, -, *, /, pow, log,abs, cos, exp, sqrt, tan, sin, ceil, floor, rint, (, ),A,MEAN, MAX, MIN, SD, COUNT, SUM, SUMSQUARED, ifelse </p>
<p>8.Reorder<br>重新排列属性，输入2-last，1可以让第一项排到最后，如果输入1,3,5的话…其他项就没有了 </p>
<p>9.Standardize<br>这个和Center功能大致相同，多了一个标准化单位变异数 </p>
<p>10.StringToNominal<br>将String型转化为Nominal型</p>
</blockquote>
<p>然后再讲一下weka.filters.unsupervised.instance包下的主要方法和含义： </p>
<ul>
<li>1.NonSparseToSparse 将所有输入转为稀疏格式 </li>
<li>2.Normalize 规范化整个实例集 </li>
<li>3.RemoveFolds 交叉验证，不支持分层，如果需要的话使用监督学习中的方法 </li>
<li>4.RemoveRange  移除制定范围的实例，化为NaN </li>
<li>5.Resample  随机抽样，从现有样本产生新的小样本 </li>
<li>6.SubsetByExpression 根据规则进行过滤，支持逻辑运算，向上取值，取绝对值等等</li>
</ul>
<p>监督学习下虽然方法比较少，但是思路有所不同，主要是在有标签的情况下，很多方法诸如抽样就必须考虑不同数据分类的比例</p>
<pre><code>//假设已经有一个数据集tempData
Normalize normalize = new Normalize();
String[] normalOptions = new String[]{&quot;-S&quot;,&quot;2.0&quot;,&quot;-T&quot;,&quot;-1.0&quot;};
normalize.setOptions(normalOptions);
normalize.setInputFormat(tempData);
newData = Filter.useFilter(tempData,normalize);
</code></pre><p>2.采样</p>
<p>数据预处理中，有一个原理很简单但是非常重要的部分：采样。良好的采样可以让数据集变得平衡，会大大的提高预测和分类的效果。<br>采样是很复杂的一个领域，背后涉及到数据的分布/数据的性质等很多内容。常见的采样有： </p>
<ul>
<li>Simple Random Sampling(简单随机采样)， </li>
<li>OfflineSampling(离线等可能K采样)， </li>
<li>Online Sampling(在线等可能K采样)， </li>
<li>Ratio-based Sampling(等比例随机采样)， </li>
<li>Acceptance-RejectionSampling(接受-拒绝采样)， </li>
<li>Importance Sampling(重要性采样)， </li>
<li>MCMC(MarkovChain Monte Carlo 马尔科夫蒙特卡罗采样算法)。</li>
</ul>
<p>Filter支持多种采样方式，其中有监督的采样比较复杂，因此主要讲解有监督学习采样方法。Filter中的Resample采样就是简单的有放回抽样。</p>
<pre><code>Resample

  Open Declaration   weka.filters.supervised.instance.Resample


Produces a random subsample of a dataset using either sampling with replacement or without replacement.
 The original dataset must fit entirely in memory. The number of instances in the generated dataset may be specified. The dataset must have a nominal class attribute. If not, use the unsupervised version. The filter can be made to maintain the class distribution in the subsample, or to bias the class distribution toward a uniform distribution. When used in batch mode (i.e. in the FilteredClassifier), subsequent batches are NOT resampled. 

 Valid options are: 


 -S &lt;num&gt;
  Specify the random number seed (default 1)
  指定随机数种子，随机数种子相同，则采样结果相同。

 -Z &lt;num&gt;
  The size of the output dataset, as a percentage of
  the input dataset (default 100)
  指定采样数据占整个数据的比例。

 -B &lt;num&gt;
  Bias factor towards uniform class distribution.
  0 = distribution in input data -- 1 = uniform distribution.
  (default 0)
 是否按照原来数据类别的分布分层抽样

 -no-replacement
  Disables replacement of instances
  (default: with replacement)

 -V
  Inverts the selection - only available with &apos;-no-replacement&apos;.

Version:$Revision: 11310 $Author:Len Trigg (len@reeltwo.com)FracPete (fracpete at waikato dot ac dot nz)Eibe Frank
</code></pre><p>使用Resample进行采样是比较简单的，下面是一个例子：</p>
<pre><code>public static Instances BoostrapSample(Instances data) {
        String[] options = {&quot;-S&quot;,1};
        Resample convert = new Resample();
        try {
            convert.setOptions(options);
            convert.setInputFormat(data);
            data = Filter.useFilter(data, convert);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return data;
    }
</code></pre><p>SMOTE采样<br>随机采样比较简单，其实Weka还支持一种附加的采样方法，在Weka3.6版本以下，这个功能嵌入在Weka包里，Weka3.7版本开始，这个功能需要额外的第三方包的支持，这种采样就是SMOTE采样。<br>SMOTE算法的思想是合成新的少数类样本，合成的策略是对每个少数类样本a，从它的最近邻中随机选一个样本b，然后在a、b之间的连线上随机选一点作为新合成的少数类样本。 这是一种过采样方法，通过制造更多模拟的少数类样本来实现各个样本之间的平衡。</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;nz.ac.waikato.cms.weka&lt;/groupId&gt;
    &lt;artifactId&gt;SMOTE&lt;/artifactId&gt;
    &lt;version&gt;1.0.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>SMOTE采样实现代码如下：</p>
<pre><code>public static Instances SMOTESample(Instances data,int normalElemFlag) {
        SMOTE convert = new SMOTE();
        int seed = (int) (Math.random() * 10);
        String[] options = {&quot;-S&quot;, String.valueOf(seed), &quot;-P&quot;, &quot;100.0&quot;, &quot;-K&quot;, &quot;5&quot;};
        Instances SmoteInstances = null;
        try {
            convert.setOptions(options);
            convert.setInputFormat(data);
            SmoteInstances = Filter.useFilter(data, convert);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return SmoteInstances;
    }
</code></pre></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/09/29/weka1/" data-id="cizbeodcu009ou0w0u2b93vq0" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/机器学习/">机器学习</a></div><div class="post-nav"><a href="/2016/09/29/weka学习2/" class="pre">机器学习weka（二）</a><a href="/2016/09/25/Object类有哪些方法/" class="next">Object类有哪些方法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javaweb/">javaweb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java杂记/">java杂记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/juc/">juc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/pat/">pat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poffer/">poffer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tomact/">tomact</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/poffer/" style="font-size: 15px;">poffer</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/javaweb/" style="font-size: 15px;">javaweb</a> <a href="/tags/juc/" style="font-size: 15px;">juc</a> <a href="/tags/java杂记/" style="font-size: 15px;">java杂记</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a> <a href="/tags/pat/" style="font-size: 15px;">pat</a> <a href="/tags/tomact/" style="font-size: 15px;">tomact</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/数据仓库/" style="font-size: 15px;">数据仓库</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/15/ms2—-mysql基准测试/">ms2—mysql基准测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/07/ms1-mysql的架构和历史/">ms1_mysql的架构和历史</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer4/">面试题4：替换空格</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer30/">面试题30：最小的k个数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer11/">面试题11：数值的整数次方</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer13/">面试题13：在O(1)时间删除链表节点</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer10/">面试题10：二进制中的1的个数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer21/">面试题21：包含min函数的栈</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer12/">面试题12：打印1到最大的n位数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/Poffer14/">面试题14：调整数组顺序使奇数位于偶数的前面</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="hellozjf.com" title="周靖峰" target="_blank">周靖峰</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">lyp's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>