<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>tcp4之流量控制差错控制和拥塞控制 | lyp's blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">tcp4之流量控制差错控制和拥塞控制</h1><a id="logo" href="/.">lyp's blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Inicio</i></a><a href="/archives/"><i class="fa fa-archive"> Archivo</i></a><a href="/about/"><i class="fa fa-user"> Acerca de</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">tcp4之流量控制差错控制和拥塞控制</h1><div class="post-meta">Mar 17, 2017<span> | </span><span class="category"><a href="/categories/tcp-ip协议族/">tcp-ip协议族</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>在讨论流量 差错 阻塞之前。我们要先描述一下窗口。tcp为每个方向的数据传输各使用两个窗口。</p>
<h3 id="窗口"><a href="#窗口" class="headerlink" title="窗口"></a>窗口</h3><h4 id="发送窗口"><a href="#发送窗口" class="headerlink" title="发送窗口"></a>发送窗口</h4><p>发送窗口大小由接收方以及底层网络拥塞成都决定。图中描绘了打开 关闭 收缩。</p>
<p><img src="C:\Users\neuly.DESKTOP-NBVHT1S\Desktop\mg\9.jpg" alt="image"></p>
<p>注意事项：</p>
<ol>
<li>tcp中为字节编号。控制窗口的变量单位是以字节为单位的。</li>
<li>tcp只是用一个计数器。</li>
</ol>
<h4 id="接收窗口"><a href="#接收窗口" class="headerlink" title="接收窗口"></a>接收窗口</h4><p><img src="C:\Users\neuly.DESKTOP-NBVHT1S\Desktop\mg\10.jpg" alt="image"></p>
<h3 id="流量控制"><a href="#流量控制" class="headerlink" title="流量控制"></a>流量控制</h3><p>平衡了生产者消费者之间的速度。</p>
<p><img src="C:\Users\neuly.DESKTOP-NBVHT1S\Desktop\mg\11.jpg" alt="image"></p>
<p>图中描述的数据走向是从发送进程乡下到达发送tcp，再从发送tcp到接受tcp，然后从接受不tcp向上到达接受进程。不过，流量控制的反馈走向是从接受tcp到发送tcp，以及从发送tcp向上到发送进程的。tcp的绝大多数实现都不提供从接受进程到接受tcp的流量控制反馈，而是让接受进程在准备就绪时去接受tcp哪里拉取数据。换言之，接受tcp控制了发送tcp。</p>
<p>为了实现流量控制，tcp强制发送方和接收方不断调整他们的窗口大小。</p>
<p>一个例子：<br><img src="C:\Users\neuly.DESKTOP-NBVHT1S\Desktop\mg\12.jpg" alt="image"></p>
<p>窗口关闭：<br>使发送窗口的右臂想做移动收缩是不希望的，但是有一个例外。接收端可以发送rwnd为0的报文来暂时关闭窗口。这种情况是由于接受方因某种原因在一段时间内不愿意从接受方接受任何数据。此时，发送方实际上并非真正的把窗口大小缩小了，只是暂定发送。直到收到一个新的通告为止。</p>
<p>糊涂窗口综合征：<br>加入tcp发送报文只包含一个字节的数据。那么意味着额外开销为41/1 （20个tcp首部 20个ip首部）。低效的。那么为了防指 就要强波发送tcp等待。怎么确定等待时间呢？</p>
<p>nagle算法：<br>1.发送tcp把他的第一个数据块发送出去，哪怕只有一个字节。<br>2.发送了第一个报文段后，发送tcp就能在输出缓存中积累数据等待，知道收到了tcp发来的确认。或者累计了足够多的 数据可以装成最大长度的报文段，这时，发送tcp就可以发送这个报文段了。<br>3.对省辖的传输，不断地重复步骤2.</p>
<h3 id="差错控制"><a href="#差错控制" class="headerlink" title="差错控制"></a>差错控制</h3><p>tcp使用差错控制来提供可靠性。差错控制包含以下的一些机制：检测和重传收到损伤的报文段，重传丢失的报文段，保存失序到达的报文段直至缺失的报文段到期，以及检测和丢弃重复的报文段。</p>
<p>tcp使用：检验和、确认、超时三个工具。</p>
<ol>
<li>每个报文段都有一个检验和字段。损伤就丢弃，病人伪是丢失了。</li>
<li>确认</li>
<li>重传</li>
<li>失序的报文段</li>
</ol>
<p>发送方tcp为每一条连接设置一个重传超时计数器。当计数器时间到，tcp发送队列中最前面的报文段，并重启计数器、</p>
<p>如果允许发送方更快的重传，而不用等待计时器超时，就能更有利于网络吞吐量。因此现在大多数实现都遵循收到三个重复ack就立刻重传丢失的报文段的规则。这一特性称为快重传。</p>
<p>失序的报文段</p>
<p>现在的tcp实现都不会丢弃失序到达的报文段，而是把这些报文段暂时保存下来，并把他们标记为失序报文段，直至缺失的报文段到期。</p>
<p>tcp数据传送的fsm</p>
<h3 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h3><p>发送方有两个信息：接收方通告的窗口大小和拥塞窗口大小。窗口的真正大小去两者之中较小的一个。</p>
<p>tcp处理yongse一般策略是基于三个阶段：慢开始，拥塞避免，拥塞检测。</p>
<ul>
<li>慢开始： cwnd从1个报文段开始，每次ack回来，便想加，是一个指数级增大的。当窗口大小到达ssthresh（慢开始门限），该阶段就结束了，并进入下一个阶段。</li>
<li>拥塞避免：加法增大 当到达慢开始门限时，加法增加阶段就开始了。每当一争个“窗口”中的报文段都被确认后，拥塞窗口大小就增加1.</li>
<li>拥塞检查：乘法减小：如果拥塞发生，窗口大写哦就必须减少。<ol>
<li>如果计时器超时，出现拥塞可能性很大，某个报文段可能在网络中某处被抛弃了，后续报文段也没有消息。<br>a. 把门限值设置为当前窗口大小的一半<br>b. 把cwnd重新设置为一个报文段。<br>c. 再次从慢开始阶段开始。</li>
<li>如果是收到三个ack，那么出现拥塞可能性较小。某段可能被丢弃，但之后的几个安全到达，因为收到了三个重复ack，称之为快重传和快恢复。在这种情况下。tcp有以下反应<br>a. 把门限值设置为当前窗口值得一半<br>b. 把cwnd设置为门限值<br>c. 启动拥塞避免阶段。</li>
</ol>
</li>
</ul>
<p>小结：<br>给出一个例子。假设最大窗口大小的初始值是32个报文段。门限的初始值设置为16.在慢开始阶段，窗口从1开始增大，直到达到门限值。拥塞避免按照加法增大，当窗口发生超时现象，乘法减小过程开始生效，吧门限值减小到窗口大小的一半。</p>
<p><img src="C:\Users\neuly.DESKTOP-NBVHT1S\Desktop\mg\13.jpg" alt="image"></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/03/17/tcp4之流量控制插座控制和拥塞控制/" data-id="cj0l70gm600e60ww0oegz7cei" class="article-share-link">Cuota</a><div class="tags"><a href="/tags/tcpip/">tcpip</a></div><div class="post-nav"><a href="/2017/03/17/tcp2之报文段/" class="pre">tcp2之报文段</a><a href="/2017/03/15/mysql7之高级特性/" class="next">mysql7之高级特性</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categorías</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/TCPIP协议族/">TCPIP协议族</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hadoop/">hadoop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javaweb/">javaweb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java杂记/">java杂记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jcf/">jcf</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/juc/">juc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jvm/">jvm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/life/">life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/pat/">pat</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/poffer/">poffer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tcp-ip协议族/">tcp-ip协议族</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tomact/">tomact</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据仓库/">数据仓库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能mysql/">高性能mysql</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Etiquetas</i></div><div class="tagcloud"><a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/jcf/" style="font-size: 15px;">jcf</a> <a href="/tags/高性能mysql/" style="font-size: 15px;">高性能mysql</a> <a href="/tags/java杂记/" style="font-size: 15px;">java杂记</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/poffer/" style="font-size: 15px;">poffer</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/TCPIP协议族/" style="font-size: 15px;">TCPIP协议族</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/hashmap/" style="font-size: 15px;">hashmap</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/juc/" style="font-size: 15px;">juc</a> <a href="/tags/life/" style="font-size: 15px;">life</a> <a href="/tags/javaweb/" style="font-size: 15px;">javaweb</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/linkedhashmap/" style="font-size: 15px;">linkedhashmap</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a> <a href="/tags/pat/" style="font-size: 15px;">pat</a> <a href="/tags/tcpip/" style="font-size: 15px;">tcpip</a> <a href="/tags/tomact/" style="font-size: 15px;">tomact</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/数据仓库/" style="font-size: 15px;">数据仓库</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recientes</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-应用层4-远程登录telnet&ssh/">TCPIP-应用层4-远程登录telnet&ssh</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-传输层4-tcp2之连接/">TCPIP-传输层4-tcp2之连接</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/面试/">面试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-传输层3-tcp1之概述(1)/">TCPIP-传输层3-tcp1之概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-应用层5-http/">TCPIP-应用层5-http</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-传输层1-介绍/">TCPIP-传输层1-介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-传输层2-用户数据包协议（udp）/">TCPIP-传输层2-用户数据包协议（udp）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-网络层/">网络层</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-应用层3-dns/">TCPIP-应用层3-dns</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/22/TCPIP-传输层5-tcp3之流量控制差错控制和拥塞控制/">TCPIP-传输层5-tcp3之流量控制差错控制和拥塞控制</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="hellozjf.com" title="周靖峰" target="_blank">周靖峰</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">lyp's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>