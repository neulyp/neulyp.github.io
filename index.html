<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
    
  
  <link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="lyp's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.jpg?v=5.0.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="lyp's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="lyp's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lyp's blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '3188510942',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>


  <title> lyp's blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">lyp's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            Kategorien
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/10/javaee7/" itemprop="url">
                  Java EE 7 Tutorial分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-12-10T16:47:25+08:00" content="2016-12-10">
              2016-12-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<p>##分析要求##</p>
<p>install Java EE7.0 JDK<br>learn Java EE 7 Tutorial，run and analysis Javae EE7.0 Samples，include</p>
<ul>
<li>Servlet 3.1<ul>
<li>The Annotations Servlet Sample Application</li>
<li>The Absolute Ordering of Web Fragments Servlet …</li>
<li>The File Upload Servlet Sample Application</li>
</ul>
</li>
<li>JAX-RS 2.0<ul>
<li>The Asynchronous Chat JAX-RS Sample Application</li>
</ul>
</li>
<li>JSON Processing 1.0<ul>
<li>The JAX-RS JSONP Sample Application</li>
</ul>
</li>
<li>WebSocket 1.0<ul>
<li>The Echo WebSocket Sample Application</li>
<li>The Auction WebSocket Sample Application</li>
</ul>
</li>
</ul>
<p><img src="http://i.imgur.com/Ev34ZJs.png" alt=""></p>
<p>##第一章：java ee7 总览##</p>
<p>JavaEE 7提供了一个完整、全面、集成的堆栈来帮助你构建企业和Web应用程序。</p>
<p>###javaEE 容器###</p>
<p>主要就是JSF（JavaServer Faces）和EJB（Enterprise Java Bean）两大部分，JSF依赖于EJB，并且是重量级的，JSF使用了一大堆组件控制页面，跟Struts2的标签差不多；EJB目前做得不错，相比Spring，EJB完全不需要作任何配置，内部包含JPA规范，可以和Hibernate无缝接入，但是学习曲线依然很大，并且对服务器有要求，用tomcat做服务器还需要和JBoss搭配，新手学习可以使用Glassfish。</p>
<p><img src="http://i.imgur.com/HOEo1LM.png" alt=""></p>
<p>###WEB 容器###</p>
<p>这部分内容比较多，JavaEE 7新添加的为下图棕黄色的部分，即WebSocket、Concurrency Utilities、Batch、JSON-P，新添加部分主要是为HTML5提供更好的伸缩性。</p>
<p><img src="http://i.imgur.com/Yp8A2E6.png" alt=""></p>
<p>###名词 概念###</p>
<p>JWS：即Java Web Service,指与webservice相关的JavaEE技术部分，webservice是一种基于XML的独立的、跨平台的、互操作的应用程序，XML又包含XSD、DTD、XPath等相关技术，这个撇开不说。webservice平台元素主要有SOAP（简易对象访问协议）、UDDI（通用描述、发现及整理）、WSDL（WS描述语言）。</p>
<p>JAX：即Java Xml，类似地JAXB（Java Xml Binding）</p>
<p>目前JWS主要有：</p>
<ul>
<li>JAX-WS 全称JavaTM API forXML-Based Web Services 又叫JAX-RPC（远程调用），顾名思义就是基于Web Services</li>
<li>JAX-RS 全称JavaTM API forRESTful Web Services 即使用REST风格</li>
<li>JAXB</li>
<li>JAXR</li>
<li>SAAJ</li>
<li>STAX</li>
</ul>
<p>网上说关于JAX-WS与JAX-RS有这么说的： 两者是不同风格的SOA架构。前者以动词为中心，指定的是每次执行函数。而后者以名词为中心，每次执行的时候指的是资源。</p>
<p>感觉这个说法比较靠谱，JAX-WS是<strong>面向消息</strong>的，每次请求的时候指定了请求的方法。JAX-RS是<strong>面向资源</strong>的。后则将网络上的东西当做一种资源，每次请求都是对该资源进行操作，比如对资源的增删查改。</p>
<p>CDI：即Contexts Dependency Injection，和Spring的IOC差不多的东西，就是可以在组件中通过注解注入上下文、请求和响应等。</p>
<p>JTA：即Java Transaction API，使用过Hibernate和EJB的应该知道，就是事务处理，JTA依赖于所处的容器，如果不是分布式开发的话，我们一般使用本地事务，即是数据库本身的事务处理。</p>
<p>PA：即Java Persistence API，就是最常用的持久化技术，原本属于EJB中的部分，EJB3.0之后分离出来，作为一个独立的规范。作为一种ORM技术，JPA提供了基本的统一标准。</p>
<p>MS：即Java Message Service，和JDBC类似，提供了一个统一的API供其他厂商实现，主要用于客户机信息的交互，JMS主要有点到点和订阅/发布两种方式</p>
<p>##第二章：servlet 3.1技术##</p>
<p>本章主要分两部分来介绍servlet技术。</p>
<p>第一部分讲解servlet的一些知识，主要参考17章：java servlet technology。主要包含以下内容：</p>
<p>3.0新特性：</p>
<ul>
<li>开发的简易型<ul>
<li>新增注解支持</li>
</ul>
</li>
<li>可插拔性和可扩展性<ul>
<li>Web 片段是将 web 应用程序逻辑分区为 servlet、servlet-mapping、servlet-filter、filter-mapping、servlet-listener 之类的元素及其子元素</li>
</ul>
</li>
<li>异步支持<ul>
<li>将新的 API 添加到 ServletRequest 和 ServletResponse，用于挂起、恢复和查询请求的状况、启用禁用和查询响应的状况。开发人员可以分别通过 requestSuspended(), requestResumed() 和 requestCompleted() 方法使用请求的 resume、suspend 和 complete 方法通知事件</li>
</ul>
</li>
<li>安全性增强<ul>
<li>Servlet3.0方案建议提供通过编程实现登录和注销功能。HTTPServletRequest 中添加的新 API 可以启用这项功能。HTTPServletRequest 的 login 方法使应用程序或者框架强制进行以容器为中介的验证。HTTPServletRequest 和 HTTPSession 的 logout 方法允许应用程序重置请求的验证状态</li>
</ul>
</li>
<li>其它杂项变化</li>
</ul>
<p>3.1新特性：</p>
<ul>
<li>无阻塞 I/O</li>
<li>协议升级</li>
<li>安全性增强</li>
</ul>
<p>第二部分分析javaee 7 simples 下面的个例子。分为以下6个模块：</p>
<ul>
<li>最基本的操作实例<ul>
<li>cookies</li>
<li>error-mapping</li>
<li>file-upload</li>
</ul>
</li>
<li>servlet3中引入的注解的例子<ul>
<li>servlet-filters</li>
<li>event-listeners</li>
</ul>
</li>
<li>注解与web.xml并存或分片处理的例子<ul>
<li>metadata-complete</li>
<li>web-fragment</li>
</ul>
</li>
<li>异步请求处理<ul>
<li>async-servlet</li>
<li>nonblocking</li>
</ul>
</li>
<li>安全验证<ul>
<li>form-based-security</li>
<li>servlet-security</li>
</ul>
</li>
<li>资源打包<ul>
<li>resource-packaging</li>
</ul>
</li>
<li>协议操作</li>
<li>protocol-handler</li>
</ul>
<h3 id="第一部分：servlet-3-1"><a href="#第一部分：servlet-3-1" class="headerlink" title="第一部分：servlet 3.1"></a>第一部分：servlet 3.1</h3><p>####2.1.1 what is a servlet? ####</p>
<p>A servlet is a Java™ technology-based Web component, managed by a container,that generates dynamic content. —— from JSR315</p>
<p><img src="http://i.imgur.com/t7UqWCg.png" alt=""></p>
<p>The service() method is given an implementation in the HTTPServletbase class, where the doGet() and doPost() methods are called.</p>
<p><img src="http://i.imgur.com/dQTarFP.png" alt=""></p>
<p>####2.1.2 Servlet Lifecycle ####<br><img src="http://i.imgur.com/n3iYiRE.png" alt=""></p>
<p>####2.1.3 writing service methods ####<br>servletrequest:</p>
<p>ServletRequest接口中封装了客户请求信息，如客户请求方式、参数名和参数值、客户端正在使用的协议, 以及发出客户请求的远程主机信息等。</p>
<p><img src="http://i.imgur.com/qfIhhsO.png" alt=""></p>
<p>ServletResponse:</p>
<p>Defines an object to assist a servlet in sending a response to the client. </p>
<p><img src="http://i.imgur.com/0ETpjHg.png" alt=""></p>
<p>####2.1.4 filtering requests and responses ####<br>Filters are Java components—very similar to servlets—that you can use to intercept and process requests before they are sent to the servlet, or to process responses after the servlet has completed, but before the response goes back to the client.</p>
<p><img src="http://i.imgur.com/zqO4Q71.png" alt=""></p>
<ul>
<li>init()</li>
<li>doFilter()</li>
<li>destory()</li>
</ul>
<p>####2.1.5 invoking other web resources ####</p>
<p>web组件能够直接或者间接的调用其他web资源。一个web组件间接地调用其他web资源通过把一个指向另一个web组件的url嵌入到返回客户端的内容中，当他被执行的时候，一个web组件直接的调用另一个资源或者包换另一个资源的内容或者只想另一个资源的请求。</p>
<p><strong>RequestDispatcher</strong></p>
<pre><code>include（request,response）
forward()
</code></pre><p>####2.1.6 accessing the web context ####</p>
<p>web组件执行的context是一个实现servletContext接口的对象，你可以取出该对象通过getServletContext方法。web context子宫访问以下内容的访问方法：</p>
<ul>
<li>Initialization parameters</li>
<li>Resources associated with the web context</li>
<li>Object-valued attributes</li>
<li>Logging capabilities</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">setAttribute(String name, Object object) </div><div class="line"> <span class="comment">//Binds an object to a given attribute name in this ServletContext.</span></div><div class="line">getAttribute(String name)</div><div class="line"><span class="comment">//Returns the servlet container attribute with the given name, or null if there is no attribute by that name.</span></div><div class="line">getRequestDispatcher(String path) </div><div class="line"><span class="comment">//Returns a RequestDispatcher object that acts as a wrapper for the resource located at the given path. </span></div><div class="line"> log(String msg) </div><div class="line"><span class="comment">//Writes the specified message to a servlet log file, usually an event log.  </span></div><div class="line">getRealPath(String path) </div><div class="line"><span class="comment">//Gets the real path corresponding to the given virtual path.</span></div></pre></td></tr></table></figure>
<p>####2.1.7 maintaining client state ####</p>
<p>http协议是无状态的。为了支持需要获取状态的应用，java servlet 技术提供了一个管理sessions的api和允许多种实现sessions的机制。</p>
<p>getSession()：返还和request关联的session对象，没有的话，创建一个。<br>getSession(false)： 返回返还和request关联的session对象，没有的话，返回null<br>isNew(）//如果客户端还没有返回具有该sessionid的session，为true</p>
<p>####2.1.8 uploading files with java servlet technology ####</p>
<p>@MultipartConfig :支持一下属性</p>
<ul>
<li>location:文件系统中目录的绝对路径</li>
<li>fileSizeThreshold:在文件被暂时存储在disk上，文件的自己额大小，默认是0字节。</li>
<li>MaxFileSize:允许上传文件的最大大小</li>
<li>maxRequestSize:最大允许一个multipart/form-data请求的数量。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MultipartConfig</span>(location=<span class="string">"/tmp"</span>, fileSizeThreshold=<span class="number">1024</span>*<span class="number">1024</span>,</div><div class="line">maxFileSize=<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">5</span>, maxRequestSize=<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">5</span>*<span class="number">5</span>)</div></pre></td></tr></table></figure>
<ul>
<li>Collection<part> getParts()</part></li>
<li>Part getPart(String name)</li>
</ul>
<p>####2.1.9 Asynchronous Processing in Servlets ####</p>
<p>使用asyncSupported属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@WebServlet</span>(urlPatterns=&#123;<span class="string">"/asyncservlet"</span>&#125;, asyncSupported=<span class="keyword">true</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123; ... &#125;</div></pre></td></tr></table></figure>
<p><code>javax.servlet.AsyncContext</code>提供方法，这些方法包含你需要异步处理的功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;</div><div class="line">...</div><div class="line">AsyncContext acontext = req.startAsync();</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://i.imgur.com/vc6RIea.png" alt=""></p>
<p>####2.1.10 Nonblocking I/O ####</p>
<p>java ee 对于servlets和filters提供非阻塞i/o ，当在异步模式下处理请求。下面的步骤总结了怎么使用非阻塞io来处理请求和写回复，在service方法中。</p>
<ol>
<li>Put the request in asynchronous mode as described in Asynchronous Processing.</li>
<li>Obtain an input stream and/or an output stream from the request and response<br>objects in the service method.</li>
<li>Assign a read listener to the input stream and/or a write listener to the output<br>stream.</li>
<li>Process the request and the response inside the listener’s callback methods.</li>
</ol>
<p><img src="http://i.imgur.com/rgWh3iZ.png" alt=""></p>
<h3 id="第二部分：-Examples-of-the-servlet"><a href="#第二部分：-Examples-of-the-servlet" class="headerlink" title="第二部分： Examples of the servlet"></a>第二部分： Examples of the servlet</h3><p>####2.2.1 Example 1：session-cookie-config ####</p>
<p>这个例子展示了session的获取和cookie的获取。</p>
<p>首先定义一个监听器，来初始化SessionCookieConfig对象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@WebListener</span>()</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Receives notification that the web application initialization</div><div class="line">     * process is starting.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> sce The servlet context event</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">        SessionCookieConfig scc =</div><div class="line">            sce.getServletContext().getSessionCookieConfig();</div><div class="line">        scc.setName(<span class="string">"MYJSESSIONID"</span>);</div><div class="line">        scc.setPath(<span class="string">"/myPath"</span>);</div><div class="line">        scc.setDomain(<span class="string">"mydomain"</span>);</div><div class="line">        scc.setComment(<span class="string">"myComment"</span>);</div><div class="line">        scc.setSecure(<span class="keyword">true</span>);</div><div class="line">        scc.setHttpOnly(<span class="keyword">true</span>);</div><div class="line">        scc.setMaxAge(<span class="number">123</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">        <span class="comment">// Do nothing</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当接收到get请求的时候，我们通过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@WebServlet</span>(urlPatterns = <span class="string">"/"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateSession</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span></span></div><div class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line"></div><div class="line">        req.getSession(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        String sessionCookie = res.getHeader(<span class="string">"Set-Cookie"</span>);</div><div class="line">        <span class="keyword">if</span> (sessionCookie == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing Set-Cookie response header"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// name</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"MYJSESSIONID="</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing session id"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// comment</span></div><div class="line">       <span class="comment">/* if (sessionCookie.indexOf("Comment=myComment") == -1) &#123;</span></div><div class="line">            throw new ServletException("Missing cookie comment");</div><div class="line">        &#125;*/</div><div class="line"></div><div class="line">        <span class="comment">// domain</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"domain=mydomain"</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing cookie domain"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// path</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"path=/myPath"</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing cookie path"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// secure</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"Secure"</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing Secure attribute"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// http-only</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"HttpOnly"</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing HttpOnly attribute"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// max-age</span></div><div class="line">        <span class="keyword">if</span> (sessionCookie.indexOf(<span class="string">"Max-Age=123"</span>) == -<span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"Missing max-age"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        res.getWriter().println(sessionCookie);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-2-Example-2：注解的使用"><a href="#2-2-2-Example-2：注解的使用" class="headerlink" title="2.2.2 Example 2：注解的使用"></a>2.2.2 Example 2：注解的使用</h4><p>TestServlet分析：<br>Servlet3.1规范大量使用注解来声明Servlet中，过滤器，监听器和安全性。配置文件web.xml中现在是可选的。</p>
<p>servlet：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.PrintWriter;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * This class illustrate WebServlet annotation</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Shing Wai Chan</div><div class="line"> */</div><div class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"TestServlet"</span>, urlPatterns = &#123;<span class="string">"/"</span>&#125;,</div><div class="line">            initParams = &#123;<span class="meta">@WebInitParam</span>(name = <span class="string">"message"</span>, value = <span class="string">"my servlet"</span>)&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String listenerMessage = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        <span class="keyword">super</span>.init(config);</div><div class="line">        listenerMessage = (String) config.getServletContext().getAttribute(<span class="string">"listenerMessage"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span></span></div><div class="line">            <span class="keyword">throws</span> IOException, ServletException &#123;</div><div class="line">        PrintWriter writer = res.getWriter();</div><div class="line">        writer.write(<span class="string">"Hello, "</span> + getInitParameter(<span class="string">"message"</span>) + <span class="string">", "</span>);</div><div class="line">        writer.write(req.getAttribute(<span class="string">"filterMessage"</span>) + <span class="string">", "</span>);</div><div class="line">        writer.write(listenerMessage + <span class="string">".\n"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@WebFilter</span>(filterName = <span class="string">"TestFilter"</span>, urlPatterns = &#123;<span class="string">"/"</span>&#125;,</div><div class="line">           initParams = &#123;<span class="meta">@WebInitParam</span>(name = <span class="string">"mesg"</span>, value = <span class="string">"my filter"</span>)&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</div><div class="line"></div><div class="line">    String mesg = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        mesg = filterConfig.getInitParameter(<span class="string">"mesg"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse res,</span></span></div><div class="line">            FilterChain chain) <span class="keyword">throws</span> IOException, ServletException &#123;</div><div class="line">        req.setAttribute(<span class="string">"filterMessage"</span>, mesg);</div><div class="line">        chain.doFilter(req, res);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@WebListener</span>()</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServletContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">        ServletContext context = sce.getServletContext();</div><div class="line">        String msg = <span class="string">"my listener"</span>;</div><div class="line">        context.setAttribute(<span class="string">"listenerMessage"</span>, msg);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果:<br><img src="http://i.imgur.com/ZRBC2kM.png" alt=""></p>
<h4 id="2-2-3-Example-3：文件上传"><a href="#2-2-3-Example-3：文件上传" class="headerlink" title="2.2.3 Example 3：文件上传"></a>2.2.3 Example 3：文件上传</h4><p>解释：<br>一个file是一个part，并且filename可以自己写方法解析，也可以直接调用方法part.getSubmittedFileName()。<br>写文件到本地，可以直接调用write（）方法，也可以自己实现。总的来说是一个很方便的功能。</p>
<p>@WebServlet标注使用URL模式属性来定义的servlet映射。</p>
<p>@MultipartConfig注释指示该servlet的期望请求被使用的multipart / form-data的MIME类型进行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</div><div class="line"><span class="keyword">import</span> java.io.FileOutputStream;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"><span class="keyword">import</span> java.util.Collection;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.MultipartConfig;</div><div class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.Part;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> Kinman Chung</div><div class="line"> * <span class="doctag">@author</span> Daniel Guo</div><div class="line"> */</div><div class="line"><span class="meta">@WebServlet</span>(name = <span class="string">"TestServlet"</span>, urlPatterns = &#123;<span class="string">"/TestServlet"</span>&#125;)</div><div class="line"><span class="meta">@MultipartConfig</span>()</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Processes requests for both HTTP</div><div class="line">     * &lt;code&gt;GET&lt;/code&gt; and</div><div class="line">     * &lt;code&gt;POST&lt;/code&gt; methods.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> request servlet request</div><div class="line">     * <span class="doctag">@param</span> response servlet response</div><div class="line">     * <span class="doctag">@throws</span> ServletException if a servlet-specific error occurs</div><div class="line">     * <span class="doctag">@throws</span> IOException if an I/O error occurs</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line">    	request.setCharacterEncoding(<span class="string">"utf-8"</span>);</div><div class="line">    	Collection&lt;Part&gt; parts= request.getParts();</div><div class="line">    	System.out.println(parts.size());</div><div class="line">    	<span class="keyword">for</span>(Part part:parts)&#123;</div><div class="line">    		System.out.println(getFileName(part));</div><div class="line">    		String name=getFileName(part);</div><div class="line">    		<span class="keyword">if</span>(name==<span class="keyword">null</span>||name.equals(<span class="string">""</span>))&#123;</div><div class="line">    			<span class="comment">//do nothing</span></div><div class="line">    		&#125;<span class="keyword">else</span>&#123;</div><div class="line">    			part.write(<span class="string">"e:/a/"</span> +getFileName(part));	</div><div class="line">    		&#125;</div><div class="line">    	&#125;</div><div class="line">       request.getRequestDispatcher(<span class="string">"getParts.jsp"</span>).forward(request, response);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getFileName</span><span class="params">(Part part)</span> </span>&#123;</div><div class="line">        String header = part.getHeader(<span class="string">"Content-Disposition"</span>);</div><div class="line">        String fileName = header.substring(header.indexOf(<span class="string">"filename=\""</span>) + <span class="number">10</span>, header.lastIndexOf(<span class="string">"\""</span>));</div><div class="line"></div><div class="line">        <span class="keyword">return</span> fileName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeTo</span><span class="params">(String fileName, Part part)</span> <span class="keyword">throws</span> IOException, FileNotFoundException </span>&#123;</div><div class="line">        InputStream in = part.getInputStream();</div><div class="line">        File file = <span class="keyword">new</span> File(<span class="string">"e:/a/"</span> + fileName);</div><div class="line">        OutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">"e:/a/"</span> + fileName);</div><div class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">        <span class="keyword">int</span> length = -<span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> ((length = in.read(buffer)) != -<span class="number">1</span>) &#123;</div><div class="line">            out.write(buffer, <span class="number">0</span>, length);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        in.close();</div><div class="line">        out.close();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// &lt;editor-fold defaultstate="collapsed" desc="HttpServlet methods. Click on the + sign on the left to edit the code."&gt;</span></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Handles the HTTP</div><div class="line">     * &lt;code&gt;GET&lt;/code&gt; method.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> request servlet request</div><div class="line">     * <span class="doctag">@param</span> response servlet response</div><div class="line">     * <span class="doctag">@throws</span> ServletException if a servlet-specific error occurs</div><div class="line">     * <span class="doctag">@throws</span> IOException if an I/O error occurs</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line">        processRequest(request, response);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Handles the HTTP</div><div class="line">     * &lt;code&gt;POST&lt;/code&gt; method.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> request servlet request</div><div class="line">     * <span class="doctag">@param</span> response servlet response</div><div class="line">     * <span class="doctag">@throws</span> ServletException if a servlet-specific error occurs</div><div class="line">     * <span class="doctag">@throws</span> IOException if an I/O error occurs</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line">        processRequest(request, response);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns a short description of the servlet.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> a String containing servlet description</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Short description"</span>;</div><div class="line">    &#125;<span class="comment">// &lt;/editor-fold&gt;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：<br><img src="http://i.imgur.com/gr81LUH.png" alt=""></p>
<h4 id="2-2-4-Example-4：web模块化"><a href="#2-2-4-Example-4：web模块化" class="headerlink" title="2.2.4 Example 4：web模块化"></a>2.2.4 Example 4：web模块化</h4><p>原本一个web应用的任何配置都需要在web.xml中进行，因此会使得web.xml变得很混乱，而且灵活性差，因此Servlet 3.0可以将每个Servlet、Filter、Listener打成jar包，然后放在WEB-INF\lib中；注意各自的模块都有各自的配置文件，这个配置文件的名称为  web-fragment.xml ;</p>
<p>步骤如下：</p>
<ol>
<li>编写Servlet，并编译；</li>
<li>将此编译class文件及所在包通过jar包命令打成jar包；</li>
<li>将此jar包用winrar打开，并将其中的META-INF中的manifest删除并添加 web-fragment.xml；</li>
<li>将此jar包放入WEB-INF\lib中即可；</li>
</ol>
<p>web-fragment.xml注意点：</p>
<ol>
<li>根元素为<web-fragment>;</web-fragment></li>
<li><name></name>表示模块名称；</li>
<li><ordering></ordering>是此模块的加载顺序；</li>
<li><before><others></others></before>表示第一个加载；</li>
<li><after><name>A</name></after>表示比A后面加载；</li>
<li>可以在里面部署listener、filter、servlet</li>
</ol>
<p>针对本例子而言，<br>为了更好地进行适配，减少配置，一个web-fragment是可指定的，并包括在一个库或框架jar文件中的web.xml的一部分或全部。如果有很多个web-fragment jars时，那么人们可能会喜欢指定处理Web-fragment.xml之和注释的顺序。这个很重要。例如，过滤器可以为在web.xml中指定的顺序被执行，类似于监听。在Servlet3.1中，引入了web.xml 中的的标签和web-fragment.xml中的标签。</p>
<p>Web Fragments的顺序被指定在以下优先级：</p>
<ul>
<li>(1)在web.xml中如果存在</li>
<li>(2)如果存在于每一个web-fragment.xml</li>
<li>(3)其他未指定</li>
</ul>
<p>在web.xml的 中提供了一种方法，以指定加载web的fragment.xml之和web fragments的注释处理的顺序。代码如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="3.0" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;</div><div class="line">    &lt;absolute-ordering&gt;</div><div class="line">        &lt;name&gt;A&lt;/name&gt;</div><div class="line">        &lt;others/&gt;</div><div class="line">        &lt;name&gt;B&lt;/name&gt;</div><div class="line">    &lt;/absolute-ordering&gt;</div><div class="line">&lt;/web-app&gt;</div></pre></td></tr></table></figure>
<p>另外，在上述例子中，web fragment A 将被第一个处理，web fragment B 被最后处理。名称A和B在web-fragment.xml之中的元素指定的（见下面的例子）。</p>
<p>排序是在web-fragment.xml中被指定的。如果在web.xml中没有，会查找web-fragment.xml中的。<br>仅仅在web-fragment.xml存在一个的jar包，代码如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;web-fragment&gt;</div><div class="line">            &lt;name&gt;A&lt;/name&gt;</div><div class="line">            ...</div><div class="line">            &lt;ordering&gt;</div><div class="line">                &lt;before&gt;</div><div class="line">                    &lt;others/&gt;</div><div class="line">                &lt;/before&gt;</div><div class="line">            &lt;/ordering&gt;</div><div class="line">&lt;/web-fragment&gt;</div></pre></td></tr></table></figure>
<p>在这种情况下，web-fragment A将首先被处理。<br>下面是在web-fragment.xml存在两个的示例，代码如下:<br>web-fragment A</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;web-fragment&gt;</div><div class="line">            &lt;name&gt;A&lt;/name&gt;</div><div class="line">            ...</div><div class="line">            &lt;ordering&gt;</div><div class="line">                &lt;before&gt;</div><div class="line">                    &lt;others/&gt;</div><div class="line">                &lt;/before&gt;</div><div class="line">            &lt;/ordering&gt;</div><div class="line">&lt;/web-fragment&gt;</div></pre></td></tr></table></figure>
<p>web-fragment B</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;web-fragment&gt;</div><div class="line">            &lt;name&gt;B&lt;/name&gt;</div><div class="line">            ...</div><div class="line">            &lt;ordering&gt;</div><div class="line">                &lt;before&gt;</div><div class="line">                    &lt;others/&gt;</div><div class="line">                &lt;/before&gt;</div><div class="line">            &lt;/ordering&gt;</div><div class="line">&lt;/web-fragment&gt;</div></pre></td></tr></table></figure>
<p>这时web-fragment A和web-fragment B会首先被处理。在这种情况下，人们只能保证web-fragment A和web-fragment B在其他web-fragment之前处理。但是A和B的顺序并不确定，在这种情况下这是随机的。<br>有两个包含 的jars 存在于web-fragment.xml之中，如下</p>
<p>web-fragment A</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;web-fragment&gt;</div><div class="line">            &lt;name&gt;A&lt;/name&gt;</div><div class="line">            ...</div><div class="line">            &lt;ordering&gt;</div><div class="line">                &lt;before&gt;</div><div class="line">                    &lt;others/&gt;</div><div class="line">                &lt;/before&gt;</div><div class="line">            &lt;/ordering&gt;</div><div class="line">&lt;/web-fragment&gt;</div></pre></td></tr></table></figure>
<p>web-fragment B</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;web-fragment&gt;</div><div class="line">            &lt;name&gt;B&lt;/name&gt;</div><div class="line">            ...</div><div class="line">            &lt;ordering&gt;</div><div class="line">                &lt;after&gt;</div><div class="line">                    &lt;name&gt;A&lt;/name&gt;</div><div class="line">                &lt;/after&gt;</div><div class="line">                &lt;before&gt;</div><div class="line">                    &lt;others/&gt;</div><div class="line">                &lt;/before&gt;</div><div class="line">            &lt;/ordering&gt;</div><div class="line">&lt;/web-fragment&gt;</div></pre></td></tr></table></figure>
<p>在这种情况下，A将首先被处理，其次是B，然后其他web fragments。如果想有一个确定的顺序，那么建议使用在web.xml中的absolute-ordering。<br>如何存放web fragments？如果一个框架被打包为一个jar文件，并在部署描述符的形式的元数据信息，那么Web fragments需要被放置在jar文件的META-INF/文件夹。</p>
<p>另一方面，如果一个框架，优先使用web fragment.xml这种方法，而且它增强了Web应用程序的web.xml，该框架必须在Web应用程序中被放置在的WEB-INF/ lib目录中。</p>
<p>运行结果：<br><img src="http://i.imgur.com/OvCgqQc.png" alt=""></p>
<p>##第三章：JAX-RS 2.0 技术##<br>当JAX-RS 1.0在2008年第一次由JSR-311——特别是其领导者Marc Hadley和Paul Sandoz——公之于众的时候，它就成为了第一个基于POJO/Annotation的、用于创建健壮的Web应用的框架。</p>
<p>五年后，Java EE 7已经发布并且它包含了最新的JAX-RS 2.0版本，JSR-339的实现由Marek Potociar和Santiago Pericas-Geertsen发起。与Java EE 7的核心主题相一致，JAX-RS 2.0添加了一些期待已久的特性，这些特性主要围绕Oracle所称的“简化API”。</p>
<p>本章主要介绍rest和jax-rs技术。分两个部分。</p>
<p>第一部分介绍相关知识和概念，主要参考第31章内容。主要包含以下内容：</p>
<ul>
<li>客户端API</li>
<li>异步</li>
<li>HATEOAS（超媒体）</li>
<li>注解</li>
<li>验证</li>
<li>过滤器与处理程序</li>
<li>内容协商</li>
</ul>
<p>第二部分主要介绍一些simples。</p>
<ul>
<li>async-chat</li>
<li>message-board</li>
</ul>
<p>###第一部分：JAX-RS: Advanced Topics####</p>
<ul>
<li><p>rest：</p>
<p>  REpresentational State Transfer：代表性状态传输、具象状态传输</p>
<p>  REST定义了应该如何正确地使用Web标准，例如HTTP和URI。REST并非标准，而是一种开发 Web 应用的架构风格，可以将其理解为一种设计模式。</p>
</li>
<li><p>jax-rs：</p>
<p>  Java API forRESTful WebServices旨在定义一个统一的规范，使得 Java 程序员可以使用一套固定的接口来开发 REST 应用，避免了依赖于第三方框架。是一个Java编程语言的应用程序接口，支持按照表象化状态转变 (REST)架构风格创建Web服务Web服务。</p>
<p>  与传统的 servlet 模型相比，JAX-RS 提供了一种可行的、更为简便、移植性更好的方式来在 Java 内实现 RESTful 服务。使用注释让您能够轻松提供 Java 资源的路径位置并将 Java 方法绑定到 HTTP 请求方法。一种可移植的数据绑定架构提供了一些本机的 Java 类型支持并允许进行序列化/反序列化处理的完全定制。javax.ws.rs.core.Application 子类的扩展以及 web.xml 内的相应清单表明了用最少的部署描述符配置就能进行轻松部署。</p>
<p>  JAX-RS 的具体实现由第三方提供，例如 Sun 的参考实现 Jersey、Apache 的 CXF 以及 JBoss 的 RESTEasy。</p>
</li>
</ul>
<p>####3.1.1 注解####</p>
<p>注释<br>新的注释已经嵌入，例如支持新的注入。<br>JAX-RS提供注解如下：<br><img src="http://i.imgur.com/ydDwiFZ.png" alt=""></p>
<ul>
<li><p>@Path，标注资源类或方法的相对路径</p>
</li>
<li><p>@GET，@PUT，@POST，@DELETE，标注方法是用的HTTP请求的类型，分别对应 4 种 HTTP 方法，用于对资源进行创建、检索、更新和删除的操作。</p>
<ul>
<li>若要创建资源，应该使用 POST 方法；</li>
<li>若要检索某个资源，应该使用 GET 方法；</li>
<li>若要更改资源状态或对其进行更新，应该使用 PUT 方法；</li>
<li>若要删除某个资源，应该使用 DELETE 方法。</li>
</ul>
</li>
<li><p>@Produces，标注返回的MIME媒体类型</p>
</li>
<li><p>@Consumes，标注可接受请求的MIME媒体类型</p>
</li>
<li><p>@PathParam，@QueryParam，@HeaderParam，@CookieParam，@MatrixParam，@FormParam，分别标注方法的参数来自于HTTP请求的不同位置，</p>
<ul>
<li>@PathParam来自于URL的路径，</li>
<li>@QueryParam来自于URL的查询参数，</li>
<li>@HeaderParam来自于HTTP请求的头信息，</li>
<li>@CookieParam来自于HTTP请求的Cookie。</li>
</ul>
</li>
</ul>
<p>具体例子如下：</p>
<ul>
<li><p>获取path参数：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/employees/&#123;firstname&#125;.&#123;lastname&#125;@&#123;domain&#125;.com"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpResource</span> </span>&#123;</div><div class="line"><span class="meta">@GET</span></div><div class="line"><span class="meta">@Produces</span>(<span class="string">"text/xml"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getEmployeelastname</span><span class="params">(@PathParam(<span class="string">"lastname"</span>)</span> String lastName) </span>&#123;</div><div class="line">...</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 在这个例子中，@path注解定义了url变量(firstname lastname domain),request请求中pathparm标签从url中获取lastname属性。你也可以使用正则表达式，比如你想要求lastname只包含大小写字母，你可以定义如下。在这里，如果lastname没有匹配正则表达式，一个404 response将会被返回。<code>@Path(&quot;/employees/{firstname}.{lastname[a-zA-Z]*}@{domain}.com&quot;)</code></p>
</li>
<li><p>获取query参数：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/employees/"</span>)</div><div class="line"><span class="meta">@GET</span></div><div class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">getEmployees</span><span class="params">(</span></span></div><div class="line">@DefaultValue(<span class="string">"2003"</span>) @<span class="title">QueryParam</span><span class="params">(<span class="string">"minyear"</span>)</span> <span class="keyword">int</span> minyear,</div><div class="line">@<span class="title">DefaultValue</span><span class="params">(<span class="string">"2013"</span>)</span> @<span class="title">QueryParam</span><span class="params">(<span class="string">"maxyear"</span>)</span> <span class="keyword">int</span> maxyear)</div><div class="line">&#123;...&#125;</div></pre></td></tr></table></figure>
<pre><code>这段代码定义了连个参数minyear和maxyear。请求如下：`GET /employees?maxyear=2013&amp;minyear=2003`我们可以得到这两个参数。
</code></pre></li>
<li><p>获取表单数据</p>
<p>  使用@formparm注解来从html forms中抽取参数。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;FORM action=&quot;http://example.com/employees/&quot; method=&quot;post&quot;&gt;</div><div class="line">&lt;p&gt;</div><div class="line">&lt;fieldset&gt;</div><div class="line">Employee name: &lt;INPUT type=&quot;text&quot; name=&quot;empname&quot; tabindex=&quot;1&quot;&gt;</div><div class="line">Employee address: &lt;INPUT type=&quot;text&quot; name=&quot;empaddress&quot; tabindex=&quot;2&quot;&gt;</div><div class="line">Manager name: &lt;INPUT type=&quot;text&quot; name=&quot;managername&quot; tabindex=&quot;3&quot;&gt;</div><div class="line">&lt;/fieldset&gt;</div><div class="line">&lt;/p&gt;</div><div class="line">&lt;/FORM&gt;</div></pre></td></tr></table></figure>
<p>  获取指定参数：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@POST</span></div><div class="line"><span class="meta">@Consumes</span>(<span class="string">"application/x-www-form-urlencoded"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(@FormParam(<span class="string">"managername"</span>)</span> String managername) </span>&#123;</div><div class="line"><span class="comment">// Store the value</span></div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  获取一个键值对map：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@POST</span></div><div class="line"><span class="meta">@Consumes</span>(<span class="string">"application/x-www-form-urlencoded"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(MultivaluedMap&lt;String, String&gt; formParams)</span> </span>&#123;</div><div class="line"><span class="comment">// Store the message</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取java类型</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getParams</span><span class="params">(@Context UriInfo ui)</span> </span>&#123;</div><div class="line">MultivaluedMap&lt;String, String&gt; queryParams = ui.getQueryParameters();</div><div class="line">MultivaluedMap&lt;String, String&gt; pathParams = ui.getPathParameters();</div><div class="line">&#125;</div><div class="line"><span class="meta">@GET</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getHeaders</span><span class="params">(@Context HttpHeaders hh)</span> </span>&#123;</div><div class="line">MultivaluedMap&lt;String, String&gt; headerParams = hh.getRequestHeaders();</div><div class="line">MultivaluedMap&lt;String, Cookie&gt; pathParams = hh.getCookies();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>####3.1.2 resource类和resource方法####</p>
<p>Web 资源作为一个 Resource 类来实现，对资源的请求由 Resource 方法来处理。</p>
<p>Resource 类或 Resource 方法被打上了 Path 标注，Path 标注的值是一个相对的 URI 路径，用于对资源进行定位，路径中可以包含任意的正则表达式以匹配资源。和大多数 JAX-RS 标注一样，Path 标注是可继承的，子类或实现类可以继承超类或接口中的 Path 标注。</p>
<p>Resource 类是 POJO，使用 JAX-RS 标注来实现相应的 Web 资源。</p>
<p>Resource 类分为根 Resource 类和子 Resource 类，区别在于子 Resource 类没有打在类上的 @Path 标注。</p>
<p>Resource 类的实例方法打上了@Path 标注，则为 Resource 方法或子 Resource 定位器，子 Resource 定位器上没有任何 @GET、@POST、@PUT、@DELETE 或者自定义的 @HttpMethod</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/"</span>)   </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookkeepingService</span> </span>&#123;   </div><div class="line">    ......   </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/person/"</span>) <span class="comment">//资源方法；若无@POST，则为子资源定位器  </span></div><div class="line">    <span class="meta">@POST</span>   </div><div class="line">    <span class="meta">@Consumes</span>(<span class="string">"application/json"</span>)   </div><div class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">createPerson</span><span class="params">(Person person)</span> </span>&#123; <span class="comment">//JSON 格式的请求体被自动映射为实体参数person  </span></div><div class="line">        ......   </div><div class="line">    &#125;   </div><div class="line">  </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/person/"</span>)   </div><div class="line">    <span class="meta">@PUT</span>   </div><div class="line">    <span class="meta">@Consumes</span>(<span class="string">"application/json"</span>)   </div><div class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">updatePerson</span><span class="params">(Person person)</span> </span>&#123;   </div><div class="line">        ......   </div><div class="line">    &#125;   </div><div class="line">  </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/person/&#123;id:\\d+&#125;/"</span>) <span class="comment">//正则表达式  </span></div><div class="line">    <span class="meta">@DELETE</span>   </div><div class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">deletePerson</span><span class="params">(@PathParam(<span class="string">"id"</span>)</span>   </span></div><div class="line">    <span class="keyword">int</span> id) &#123;   </div><div class="line">        ......   </div><div class="line">    &#125;   </div><div class="line">  </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/person/&#123;id:\\d+&#125;/"</span>)   </div><div class="line">    <span class="meta">@GET</span>   </div><div class="line">    <span class="meta">@Produces</span>(<span class="string">"application/json"</span>)   </div><div class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">readPerson</span><span class="params">(@PathParam(<span class="string">"id"</span>)</span>   </span></div><div class="line">    <span class="keyword">int</span> id) &#123;   </div><div class="line">        ......   </div><div class="line">    &#125;   </div><div class="line">  </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/persons/"</span>)   </div><div class="line">    <span class="meta">@GET</span>   </div><div class="line">    <span class="meta">@Produces</span>(<span class="string">"application/json"</span>)   </div><div class="line">    <span class="keyword">public</span> Person[] readAllPersons() &#123; <span class="comment">//数组类型的返回值被自动映射为 JSON 格式的响应体——？  </span></div><div class="line">        ......   </div><div class="line">    &#125;   </div><div class="line">  </div><div class="line">    <span class="meta">@Path</span>(<span class="string">"/person/&#123;name&#125;/"</span>)   </div><div class="line">    <span class="meta">@GET</span>   </div><div class="line">    <span class="meta">@Produces</span>(<span class="string">"application/json"</span>)   </div><div class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">readPersonByName</span><span class="params">(@PathParam(<span class="string">"name"</span>)</span>   </span></div><div class="line">    String name) &#123;   </div><div class="line">        ......   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Resource 方法合法的参数类型包括：</p>
<ol>
<li>原生类型</li>
<li>构造函数接收单个字符串参数，或者包含拥有一个static的valueOf(String)方法</li>
<li>List<t>，Set<t>，SortedSet<t>（T 为以上的 2 种类型）</t></t></t></li>
<li>用于映射请求体的实体参数</li>
</ol>
<p>Resource 方法合法的返回值类型包括：</p>
<ol>
<li>void：状态码 204 和空响应体</li>
<li>Response：Response 的 status 属性指定了状态码，entity 属性映射为响应体<code>return Response.status(Status.OK).entity(JsonUtils.toString(result)).build();</code></li>
<li>GenericEntity：GenericEntity 的 entity 属性映射为响应体，entity 属性为空则状态码为 204，非空则状态码为 200</li>
<li>其它类型：返回的对象实例映射为响应体，实例为空则状态码为 204，非空则状态码为 200</li>
</ol>
<p>对于错误处理，Resource 方法可以抛出非受控异常 WebApplicationException 或者返回包含了适当的错误码集合的 Response 对象。</p>
<p>####3.1.3 内容协商与数据绑定####<br>Web 资源可以有不同的表现形式，服务端与客户端之间需要一种称为内容协商（Content Negotiation）的机制：</p>
<p>作为服务端，Resource 方法的@Produces 标注用于指定响应体的数据格式（MIME 类型），@Consumes 标注用于指定请求体的数据格式；</p>
<p>作为客户端，Accept 请求头用于选择响应体的数据格式，Content-Type 请求头用于标识请求体的数据格式。</p>
<p>服务器端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@GET</span>  </div><div class="line"><span class="meta">@Path</span>(value=<span class="string">"/&#123;emailAddress:.+@.+\\.[a-z]+&#125;"</span>)  </div><div class="line"><span class="meta">@Produces</span>(value=&#123;<span class="string">"text/xml"</span>, <span class="string">"application/json"</span>&#125;)  </div><div class="line"><span class="function"><span class="keyword">public</span> ContactInfo <span class="title">getByEmailAddress</span><span class="params">(@PathParam(value=<span class="string">"emailAddress"</span>)</span>   </span></div><div class="line">    String emailAddress) &#123;  </div><div class="line">    ...  </div><div class="line">&#125;     </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="meta">@POST</span>  </div><div class="line"><span class="meta">@Consumes</span>(value=&#123;<span class="string">"text/xml"</span>, <span class="string">"application/json"</span>&#125;)  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addContactInfo</span><span class="params">(ContactInfo contactInfo)</span> </span>&#123;  </div><div class="line">    ...  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####3.1.4 bean验证####</p>
<p>一个基于注释的机制来识别参数的meta-data。例如“@NotNull shares”代表“shares”参数不允许为null。你同样可以提供传统的注释，比如保证特定的数据格式，例如邮编或者电话号码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@POST</span></div><div class="line"><span class="meta">@Path</span>(<span class="string">"/createUser"</span>)</div><div class="line"><span class="meta">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUser</span><span class="params">(@NotNull @FormParam(<span class="string">"username"</span>)</span> String username,</span></div><div class="line">@NotNull @<span class="title">FormParam</span><span class="params">(<span class="string">"firstName"</span>)</span> String firstName,</div><div class="line">@NotNull @<span class="title">FormParam</span><span class="params">(<span class="string">"lastName"</span>)</span> String lastName,</div><div class="line">@Email @<span class="title">FormParam</span><span class="params">(<span class="string">"email"</span>)</span> String email) &#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>也可以用到一个resource class中，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/createUser"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateUserResource</span> </span>&#123;</div><div class="line"><span class="meta">@NotNull</span></div><div class="line"><span class="meta">@FormParam</span>(<span class="string">"username"</span>)</div><div class="line"><span class="keyword">private</span> String username;</div><div class="line"><span class="meta">@NotNull</span></div><div class="line"><span class="meta">@FormParam</span>(<span class="string">"firstName"</span>)</div><div class="line"><span class="keyword">private</span> String firstName;</div><div class="line"><span class="meta">@NotNull</span></div><div class="line"><span class="meta">@FormParam</span>(<span class="string">"lastName"</span>)</div><div class="line"><span class="keyword">private</span> String lastName;</div><div class="line"><span class="meta">@Email</span></div><div class="line"><span class="meta">@FormParam</span>(<span class="string">"email"</span>)</div><div class="line"><span class="keyword">private</span> String email;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####3.1.5 客户端api####</p>
<p>JAX-RS 1.0是一个严格的客户端API，一些实现对客户端提供了各种等级的支持，但是通常开发人员会安装像Apache软件基Jakarte公共组件中的HttpClient 或 WizTools的 REST Client。</p>
<p>JAX-RS 2.0 为客户端调用Web服务添加了一个”构建” 工具:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Client client=ClientFactory.newClient();</div><div class="line">String shares=client.target(<span class="string">"http://.../portfolio/123"</span>)</div><div class="line">    .pathParam(<span class="string">"identifier"</span>, <span class="string">"IBM"</span>)</div><div class="line">    .queryParameter(<span class="string">"identifierType"</span>, <span class="string">"ticker"</span>)</div><div class="line">    .request(<span class="string">"text/plain).get(String.class"</span>);</div></pre></td></tr></table></figure>
<p>我们看，这个方法首先包含了一个客户端(client)，然后使用了构建模式来构造URL的所有参数，同时，允许开发人员不需要使用各种各样的URL构造器来规划URL。</p>
<p>####3.1.6 异步####<br>异步：<br>在JAX-RS 1.0中，一个要调用的客户端需要等待服务器传回的响应。2.0嵌入了异步支持。这让一个客户端能够发起一个REST的调用，并且在响应完成的时候得到一个Future或者一个InvocationCallback作为通知。</p>
<p>####3.1.7 HATEOAS####<br>根据严格的RESTafarian规范，如果你没有使用HATEOAS，你就不是在做REST！HATEOAS（作为应用状态引擎的超媒体）要求REST的生产者和客户在“每个调用返回一组链接”上达成共识，以便进行下一步。如果你认为REST是一个应用版本的Web页，那么HATEOAS就可以认为是包含一组Web页面的链接。</p>
<p>JAX-RS 2.0提供了Link和Target类，来把超链接嵌入到一个服务器端的响应当中，并把它们响应到客户端去。</p>
<p>###第二部分：Examples of the JAX-RS 2.0 ##</p>
<h4 id="3-2-1-Example-1-async-war"><a href="#3-2-1-Example-1-async-war" class="headerlink" title="3.2.1 Example 1 async-war"></a>3.2.1 Example 1 async-war</h4><p>分析：</p>
<p>chatApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.HashSet;</div><div class="line"><span class="keyword">import</span> java.util.Set;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.ws.rs.ApplicationPath;</div><div class="line"><span class="keyword">import</span> javax.ws.rs.core.Application;</div><div class="line"></div><div class="line"><span class="meta">@ApplicationPath</span>(<span class="string">"/chat"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getClasses() &#123;</div><div class="line">        <span class="keyword">final</span> Set&lt;Class&lt;?&gt;&gt; classes = <span class="keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;();</div><div class="line">        classes.add(ChatResource.class);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> classes;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/"</span>)</div><div class="line"><span class="meta">@Singleton</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatResource</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * This queue synchronizes produces/consumes operations. It contains &#123;<span class="doctag">@link</span> AsyncResponse async responses&#125; into</div><div class="line">     * which post message should be written.</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;AsyncResponseWrapper&gt; suspended = <span class="keyword">new</span> ArrayBlockingQueue&lt;AsyncResponseWrapper&gt;(<span class="number">10</span>);</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Internal response wrapper which bundles response with id.</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncResponseWrapper</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AsyncResponse asyncResponse;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String id;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="title">AsyncResponseWrapper</span><span class="params">(AsyncResponse asyncResponse, String id)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.asyncResponse = asyncResponse;</div><div class="line">            <span class="keyword">this</span>.id = id;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> AsyncResponse <span class="title">getAsyncResponse</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> asyncResponse;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> id;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Handle a HTTP get message asynchronously (suspend response in order to release the container thread instead of</div><div class="line">     * blocking it on the blocking queue).</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> asyncResponse Suspended asynchronous response (injected).</div><div class="line">     * <span class="doctag">@param</span> requestId Header identifying the header.</div><div class="line">     */</div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getMessage</span><span class="params">(@Suspended <span class="keyword">final</span> AsyncResponse asyncResponse, <span class="keyword">final</span> @HeaderParam(<span class="string">"request-id"</span>)</span> String requestId) </span>&#123;</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    <span class="comment">// Put actual response to the queue. This response will be later taken and resumed with</span></div><div class="line">                    <span class="comment">// the message.</span></div><div class="line">                    suspended.put(<span class="keyword">new</span> AsyncResponseWrapper(asyncResponse, requestId));</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Handle a HTTP POST method asynchronously (suspend response in order to release the container thread instead of</div><div class="line">     * blocking it on the blocking queue).</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> postAsyncResponse Suspended asynchronous response (injected).</div><div class="line">     * <span class="doctag">@param</span> message Message to be sent.</div><div class="line">     */</div><div class="line">    <span class="meta">@POST</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postMessage</span><span class="params">(@Suspended <span class="keyword">final</span> AsyncResponse postAsyncResponse, <span class="keyword">final</span> String message)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    <span class="comment">// Take one response from the queue and resume it with the message. If no message is in the queue now</span></div><div class="line">                    <span class="comment">// then this method will block the thread until the response is put into queue (by GET http method).</span></div><div class="line">                    <span class="keyword">final</span> AsyncResponseWrapper responseWrapper = suspended.take();</div><div class="line">                    responseWrapper.getAsyncResponse().resume(Response.ok()</div><div class="line">                            .entity(message).header(<span class="string">"request-id"</span>, responseWrapper.getId()).build());</div><div class="line"></div><div class="line">                    <span class="comment">// Now resume response connected with the request invoking this post method just reply that the message</span></div><div class="line">                    <span class="comment">// was delivered.</span></div><div class="line">                    postAsyncResponse.resume(<span class="string">"Sent!"</span>);</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get the string representation of internal async response queue &lt;code&gt;suspended&lt;code/&gt;.</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * This resource is requested in regular intervals by clients.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span> Plain text with list of request-id of async responses.</div><div class="line">     */</div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Path</span>(<span class="string">"queue"</span>)</div><div class="line">    <span class="meta">@Produces</span>(<span class="string">"text/html"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResponseQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">        <span class="keyword">boolean</span> addSeparator = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (AsyncResponseWrapper asyncResponseWrapper : suspended) &#123;</div><div class="line">            <span class="keyword">if</span> (addSeparator) &#123;</div><div class="line">                sb.append(<span class="string">", "</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                addSeparator = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            sb.append(asyncResponseWrapper.getId());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-2-2-Example-2：-message-board"><a href="#3-2-2-Example-2：-message-board" class="headerlink" title="3.2.2 Example 2： message-board"></a>3.2.2 Example 2： message-board</h4><p>详情见源代码</p>
<p>##第四章：json processing 1.0 总览##</p>
<p>主要参照第19章：json processing</p>
<h3 id="第一部分：json-processing-介绍"><a href="#第一部分：json-processing-介绍" class="headerlink" title="第一部分：json processing 介绍"></a>第一部分：json processing 介绍</h3><p>####4.1.1 json####</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"><span class="attr">"firstName"</span>: <span class="string">"Duke"</span>,</div><div class="line"><span class="attr">"lastName"</span>: <span class="string">"Java"</span>,</div><div class="line"><span class="attr">"age"</span>: <span class="number">18</span>,</div><div class="line"><span class="attr">"streetAddress"</span>: <span class="string">"100 Internet Dr"</span>,</div><div class="line"><span class="attr">"city"</span>: <span class="string">"JavaTown"</span>,</div><div class="line"><span class="attr">"state"</span>: <span class="string">"JA"</span>,</div><div class="line"><span class="attr">"postalCode"</span>: <span class="string">"12345"</span>,</div><div class="line"><span class="attr">"phoneNumbers"</span>: [</div><div class="line">&#123; <span class="attr">"Mobile"</span>: <span class="string">"111-111-1111"</span> &#125;,</div><div class="line">&#123; <span class="attr">"Home"</span>: <span class="string">"222-222-2222"</span> &#125;</div><div class="line">]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>http header:<br><code>Content-Type: application/json</code></p>
<p>####4.1.2 json processing in the java ee platform####</p>
<p><img src="http://i.imgur.com/XUTrGIq.png" alt=""></p>
<p>####4.1.3 using the object model api####</p>
<p>构建json对象<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">JsonObject model = Json.createObjectBuilder()</div><div class="line">.add(<span class="string">"firstName"</span>, <span class="string">"Duke"</span>)</div><div class="line">.add(<span class="string">"lastName"</span>, <span class="string">"Java"</span>)</div><div class="line">.add(<span class="string">"age"</span>, <span class="number">18</span>)</div><div class="line">.add(<span class="string">"streetAddress"</span>, <span class="string">"100 Internet Dr"</span>)</div><div class="line">.add(<span class="string">"city"</span>, <span class="string">"JavaTown"</span>)</div><div class="line">.add(<span class="string">"state"</span>, <span class="string">"JA"</span>)</div><div class="line">.add(<span class="string">"postalCode"</span>, <span class="string">"12345"</span>)</div><div class="line">.add(<span class="string">"phoneNumbers"</span>, Json.createArrayBuilder()</div><div class="line">.add(Json.createObjectBuilder()</div><div class="line">.add(<span class="string">"type"</span>, <span class="string">"mobile"</span>)</div><div class="line">.add(<span class="string">"number"</span>, <span class="string">"111-111-1111"</span>))</div><div class="line">.add(Json.createObjectBuilder()</div><div class="line">.add(<span class="string">"type"</span>, <span class="string">"home"</span>)</div><div class="line">.add(<span class="string">"number"</span>, <span class="string">"222-222-2222"</span>)))</div><div class="line">.build();</div></pre></td></tr></table></figure></p>
<h3 id="第二部分：Examples-of-json-processing"><a href="#第二部分：Examples-of-json-processing" class="headerlink" title="第二部分：Examples of json processing"></a>第二部分：Examples of json processing</h3><p>jsonobject例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/object"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectResource</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JsonBuilderFactory bf = Json.createBuilderFactory(<span class="keyword">null</span>);</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> JsonObject <span class="title">doGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> bf.createObjectBuilder()</div><div class="line">            .add(<span class="string">"firstName"</span>, <span class="string">"John"</span>)</div><div class="line">            .add(<span class="string">"lastName"</span>, <span class="string">"Smith"</span>)</div><div class="line">            .add(<span class="string">"age"</span>, <span class="number">25</span>)</div><div class="line">            .add(<span class="string">"address"</span>, bf.createObjectBuilder()</div><div class="line">                .add(<span class="string">"streetAddress"</span>, <span class="string">"21 2nd Street"</span>)</div><div class="line">                .add(<span class="string">"city"</span>, <span class="string">"New York"</span>)</div><div class="line">                .add(<span class="string">"state"</span>, <span class="string">"NY"</span>)</div><div class="line">                .add(<span class="string">"postalCode"</span>, <span class="string">"10021"</span>))</div><div class="line">            .add(<span class="string">"phoneNumber"</span>, bf.createArrayBuilder()</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"home"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"212 555-1234"</span>))</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"fax"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"646 555-4567"</span>)))</div><div class="line">            .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@POST</span></div><div class="line">    <span class="meta">@Consumes</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(JsonObject structure)</span> </span>&#123;</div><div class="line">        System.out.println(structure);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsonarray例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/array"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayResource</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JsonBuilderFactory bf = Json.createBuilderFactory(<span class="keyword">null</span>);</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> JsonArray <span class="title">doGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> bf.createArrayBuilder()</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"home"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"212 555-1234"</span>))</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"fax"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"646 555-4567"</span>))</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@POST</span></div><div class="line">    <span class="meta">@Consumes</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(JsonArray structure)</span> </span>&#123;</div><div class="line">        System.out.println(structure);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jsonStructure</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/structure"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StructureResource</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JsonBuilderFactory bf = Json.createBuilderFactory(<span class="keyword">null</span>);</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> JsonStructure <span class="title">doGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> bf.createObjectBuilder()</div><div class="line">            .add(<span class="string">"firstName"</span>, <span class="string">"John"</span>)</div><div class="line">            .add(<span class="string">"lastName"</span>, <span class="string">"Smith"</span>)</div><div class="line">            .add(<span class="string">"age"</span>, <span class="number">25</span>)</div><div class="line">            .add(<span class="string">"address"</span>, bf.createObjectBuilder()</div><div class="line">                .add(<span class="string">"streetAddress"</span>, <span class="string">"21 2nd Street"</span>)</div><div class="line">                .add(<span class="string">"city"</span>, <span class="string">"New York"</span>)</div><div class="line">                .add(<span class="string">"state"</span>, <span class="string">"NY"</span>)</div><div class="line">                .add(<span class="string">"postalCode"</span>, <span class="string">"10021"</span>))</div><div class="line">            .add(<span class="string">"phoneNumber"</span>, bf.createArrayBuilder()</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"home"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"212 555-1234"</span>))</div><div class="line">                .add(bf.createObjectBuilder()</div><div class="line">                    .add(<span class="string">"type"</span>, <span class="string">"fax"</span>)</div><div class="line">                    .add(<span class="string">"number"</span>, <span class="string">"646 555-4567"</span>)))</div><div class="line">            .build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@POST</span></div><div class="line">    <span class="meta">@Consumes</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(JsonStructure structure)</span> </span>&#123;</div><div class="line">        System.out.println(structure);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>JsonGenerator例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/generator"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorResource</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Produces</span>(MediaType.APPLICATION_JSON)</div><div class="line">    <span class="function"><span class="keyword">public</span> StreamingOutput <span class="title">doGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StreamingOutput() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(OutputStream os)</span> </span>&#123;</div><div class="line">                writeWikiExample(os);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Writes wiki example JSON in a streaming fashion</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeWikiExample</span><span class="params">(OutputStream os)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span>(JsonGenerator gene = Json.createGenerator(os)) &#123;</div><div class="line">            gene.writeStartObject()</div><div class="line">                .write(<span class="string">"firstName"</span>, <span class="string">"John"</span>)</div><div class="line">                .write(<span class="string">"lastName"</span>, <span class="string">"Smith"</span>)</div><div class="line">                .write(<span class="string">"age"</span>, <span class="number">25</span>)</div><div class="line">                .writeStartObject(<span class="string">"address"</span>)</div><div class="line">                    .write(<span class="string">"streetAddress"</span>, <span class="string">"21 2nd Street"</span>)</div><div class="line">                    .write(<span class="string">"city"</span>, <span class="string">"New York"</span>)</div><div class="line">                    .write(<span class="string">"state"</span>, <span class="string">"NY"</span>)</div><div class="line">                    .write(<span class="string">"postalCode"</span>, <span class="string">"10021"</span>)</div><div class="line">                .writeEnd()</div><div class="line">                .writeStartArray(<span class="string">"phoneNumber"</span>)</div><div class="line">                    .writeStartObject()</div><div class="line">                        .write(<span class="string">"type"</span>, <span class="string">"home"</span>)</div><div class="line">                        .write(<span class="string">"number"</span>, <span class="string">"212 555-1234"</span>)</div><div class="line">                    .writeEnd()</div><div class="line">                    .writeStartObject()</div><div class="line">                        .write(<span class="string">"type"</span>, <span class="string">"fax"</span>)</div><div class="line">                        .write(<span class="string">"number"</span>, <span class="string">"646 555-4567"</span>)</div><div class="line">                    .writeEnd()</div><div class="line">                .writeEnd()</div><div class="line">            .writeEnd();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>JsonParser例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Path</span>(<span class="string">"/parser"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParserResource</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="meta">@Produces</span>(<span class="string">"text/plain"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> StreamingOutput <span class="title">doGet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StreamingOutput() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(OutputStream os)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">                writeTwitterFeed(os);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Parses JSON from twitter search REST API</div><div class="line">     *</div><div class="line">     * ... &#123; ... "from_user" : "xxx", ..., "text: "yyy", ... &#125; ...</div><div class="line">     *</div><div class="line">     * then writes to HTTP output stream as follows:</div><div class="line">     *</div><div class="line">     * xxx: yyy</div><div class="line">     * --------</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeTwitterFeed</span><span class="params">(OutputStream os)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        URL url = <span class="keyword">new</span> URL(<span class="string">"http://search.twitter.com/search.json?q=%23java"</span>);</div><div class="line">        <span class="keyword">try</span>(InputStream is = url.openStream();</div><div class="line">            JsonParser parser = Json.createParser(is);</div><div class="line">            PrintWriter ps = <span class="keyword">new</span> PrintWriter(<span class="keyword">new</span> OutputStreamWriter(os, <span class="string">"UTF-8"</span>))) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(parser.hasNext()) &#123;</div><div class="line">                Event e = parser.next();</div><div class="line">                <span class="keyword">if</span> (e == Event.KEY_NAME) &#123;</div><div class="line">                    <span class="keyword">if</span> (parser.getString().equals(<span class="string">"from_user"</span>)) &#123;</div><div class="line">                        parser.next();</div><div class="line">                        ps.print(parser.getString());</div><div class="line">                        ps.print(<span class="string">": "</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parser.getString().equals(<span class="string">"text"</span>)) &#123;</div><div class="line">                        parser.next();</div><div class="line">                        ps.println(parser.getString());</div><div class="line">                        ps.println(<span class="string">"---------"</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##第四章：WebSocket 1.0分析##</p>
<p>作为Html5新特性之一的WebSocket组件，在实时性有一定要求的WEB应用开发 中还是有一定用武之地，高版本的IE、Chrome、FF浏览器都支持Websocket，标准的Websocket通信是基于RFC6455实现服务器 端与客户端握手与消息接发的。如果对Websocket通信不是太理解，可以查看RFC文档即可，简单说就是通过发送HTTP请求，实现双方握手，将无状 态的HTTP通信协议进一步升级成有状态的通信协议，同时Websocket还支持子协议选项与安全传输。标准的websocket连接URL以ws开 头，如果是基于TLS的则以wss开头。</p>
<p>###第一部分:java api for websocket###</p>
<p>参考第18章：java api for websocket</p>
<p>###第二部分:Examples for websocket###</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/hadoop分布式文件系统详解/" itemprop="url">
                  hadoop分布式文件系统详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-12-06T21:11:33+08:00" content="2016-12-06">
              2016-12-06
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###1.大数据概念 ###</p>
<blockquote>
<p>麦肯锡说：大数据指的是所涉及的数据集规模已经超过了传统<br>数据库软件的获取、存储、管理和分析的能力。<br>随着技术的不断发展，符合大数据标准的数据集容量也会增长。<br>并且大数据的定义随着不同行业也有变化。</p>
<p> IBM说：可以用3个特征相结合来定义大数据：<strong>数量（Volume），种类(Variety)，速度(Velocity)</strong>，即庞大容量，极快速度和种类丰富的数据。</p>
</blockquote>
<p>大数据的特征：大量化，快速化，多样化，价值化</p>
<p>###2.数据库VS大数据 ###</p>
<ul>
<li>1、数据规模： “池塘”的处理对象通常以MB 为基本单位，而“大<br>  海”则常常以GB，甚至是TB、PB 为基本处理单位。</li>
<li>2、数据类型：过去的“池塘”中，数据的种类单一，往往仅仅有一<br>  种或少数几种，这些数据又以结构化数据为主。而在“大海”中，数<br>  据的种类繁多，数以千计，而这些数据又包含着结构化、半结构化以<br>  及非结构化的数据，并且半结构化和非结构化数据所占份额越来越大<br>  。</li>
<li>3、模式(Schema)和数据的关系：传统的数据库都是先有模式，然后<br>  才会产生数据。这就好比是先选好合适的“池塘”，然后才会向其中<br>  投放适合在该“池塘”环境生长的“鱼”。而大数据时代很多情况下<br>  难以预先确定模式，模式只有在数据出现之后才能确定，且模式随着<br>  数据量的增长处于不断的演变之中。这就好比先有少量的鱼类，随着<br>  时间推移，鱼的种类和数量都在不断的增长。鱼的变化会使大海的成<br>  分和环境处于不断的变化之中。</li>
<li>4、处理对象：在“池塘”中捕鱼，“鱼”仅仅是其捕捞对象。而在<br>  “大海”中，“鱼”除了是捕捞对象之外，还可以通过某些“鱼”的<br>  存在来判断其他种类的“鱼”是否存在。也就是说传统数据库中数据<br>  仅作为处理对象。而在大数据时代，要将数据作为一种资源来辅助解<br>  决其他诸多领域的问题。</li>
<li>5、处理工具：捕捞“池塘”中的“鱼”，一种渔网或少数几种基本<br>  就可以应对，也就是所谓的One Size Fits All。但是在“大海”中，<br>  不可能存在一种渔网能够捕获所有的鱼类，也就是说No Size Fits All</li>
</ul>
<p>###3.Hadoop###</p>
<ul>
<li>一个分布式文件系统和并行执行环境（框架）</li>
<li>让用户便捷地处理海量数据</li>
<li>Apache软件基金会下面的一个开源项目</li>
<li>目前Yahoo!是最主要的贡献者</li>
</ul>
<p>hadoop的特点：</p>
<ul>
<li>扩容能力（Scalable）：能可靠地（reliably）存储和处理千兆字节（PB）数据。</li>
<li>成本低（Economical）：可以通过普通机器组成的服务器群来分发以及处理数据。这些服务器群总计可达数千个节点。</li>
<li>高效率（Efficient）：通过分发数据，hadoop可以在数据所在的节点上并行地（parallel）处理它们，这使得处理非常的快速。</li>
<li>可靠性（Reliable）：hadoop能自动地维护数据的多份复制，并且在任务失败后能自动地重新部署（redeploy）计算任务。</li>
</ul>
<p>hadoop生态系统：<br><img src="http://i.imgur.com/kFpATOP.png" alt=""></p>
<p>###3.Hdfs文件系统架构###</p>
<p>设计目标：</p>
<ul>
<li>为以流式数据访问模式存储超大文件而设计的文件系统<ul>
<li>超大文件<br>指的是几百MB，几百GB，几百TB，甚至几百PB</li>
<li>流式数据访问<br>HDFS建立的思想是：一次写入、多次读取模式是最高效的。</li>
<li>商用硬件<br>HDFS不需要运行在昂贵并且高可靠的硬件上。</li>
</ul>
</li>
</ul>
<p>设计基础与目标：</p>
<ul>
<li>硬件错误是常态，因此需要冗余。</li>
<li>程序采用“数据就近”原则分配节点执行。</li>
</ul>
<p>hdfs体系：<br>hdfs是一个主从结构的体系，一个hdfs集群由以下部分组成。<br>1.namenode： 一个，用来管理文件的名字空间和调节客户端访问文件的主服务器。<br>2.datanode：一个或多个，用来管理存储。提供真是文件数据的存储服务。</p>
<p><img src="http://i.imgur.com/pdHbox9.png" alt=""></p>
<p>1.机架：rack</p>
<p>2.数据块：block 64M<br>hadoop fsck / -files -blocks</p>
<p>3.元数据节点：namenode<br>namenode 决定是否将文件映射到datanode的复制块上，对于最常见的3个复制快，第一个复制快存储在同一个机架上的不同节点上，最后一个复制快存储在不同机器上的某个节点上。</p>
<p>主要功能：</p>
<p>namenode提供名称查询服务。<br>namenode保存metadate信息。具体包括;文件owership和permissions；文件包含哪些块；block保存在哪个datanode上。<br>namenode的metadate信息在启动后会加载到内存。</p>
<p>4.数据节点：datanode</p>
<ul>
<li>保存block，每个快对应一个元数据信息文件，这个文件主要描述这个块属于哪个文件，第几个块等信息。</li>
<li>启动datanode线程的时候会向namenode回报block信息。</li>
<li>通过向namenode发送心跳保持与其连系（3s一次），如果namenode10分钟没有收到datanode的心跳，认为其已经lost，并将其上的block复制到其他的datanode。</li>
</ul>
<p>5.辅助元数据节点：secondarynamenode</p>
<p><img src="http://i.imgur.com/Lrjf9Tm.png" alt=""><br>辅助元数据节点，会周期性的将editslog文件中记录对hdfs的操作合并到一个fsimage中，然后清空editslog。namenode重启就会加载最新的fsimage文件，并重新创建一个editslog文件来记录hdfs。</p>
<p>6.名字空间 namespace</p>
<p>7.数据复制</p>
<p>8.快备份原理</p>
<p><img src="http://i.imgur.com/ortzuIT.png" alt=""></p>
<p>9.机架感知</p>
<p>###4.hadoop rpc机制###</p>
<p>一般的RPC，都要考虑两个问题。对象调用方式和序列化反序列化机制<br>hadoop rpc使用java动态代理和反射实现了对象调用方式，客户端到服务器数据的序列化和反序列化由hadoop框架或用火自己实现，也就是数据组装时定制的。<br><img src="http://i.imgur.com/BWCh7o4.png" alt=""></p>
<p>文件的读和写<br><img src="http://i.imgur.com/EmUaCxm.png" alt=""></p>
<p>客户端联系NameNode,得到所有数据块信息，以及数据块对应的所有数据服务器的位置信息<br>尝试从某个数据块对应的一组数据服务器中选出一个，进行连接<br>数据被一个包一个包发送回客户端，等到整个数据块的数据都被读取完了，就会断开此链接，尝试连接下一个数据块对应的数据服务器，整个流程，依次如此反复，直到所有想读的都读取完了为止。<br>Namenode并不实际参与数据传输</p>
<p><img src="http://i.imgur.com/6M44r2f.png" alt=""></p>
<p>客户端联系namenode，在namenode命名空间中创建一个新文件，此时，namenode会检查文件是否存在和客户端是否有权限创建新文件，检查通过，就会创建一条记录。<br>然后客户端写文件时，会取得合适的3个datanodes形成一个管线DataStreamer将数据包流式的传输到管线中第一个datanode，第一个datanode存储数据包并发送的第二个datanode, 第二个datanode存储数据包并发送的第三个datanode。<br>当收到管道中所有datanodes的确认信息后对应数据包才会从确认队列中删除。<br>如此反复，直到所有的数据包，都写完，最后向namenode报告写入完成。</p>
<p>###4.hadoop ha机制###<br>如果namenode节点坏掉，将会影响整个集群。 hdfs的高可用性（high availability ha）就可以解决这个问题。通过提供选择运行在同一个集群的一个热备份的‘主/备’两个冗余的namenode，允许在机器宕机或系统维护的时候，快速的转移到另一个namenode。</p>
<p><img src="http://i.imgur.com/mdwV6S7.png" alt=""></p>
<p>###5.hdfs federation机制###</p>
<p>简单来说， hdfs federation 就是使得hdfs支持多个名字空间，并且允许在hdfs中同时存在多个namenode</p>
<p>###6.hdfs处理文件的命令###</p>
<p>hadoop fs -mkdir /input<br>hadoop fs -ls /input<br>hadoop fs - put test.txt /input/<br>hadoop fs -text /input/test.txt<br>hadoop fs -get /input/text.txt<br>hadoop fs -rm /input/text.txt</p>
<p>###7.java api 接口###</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/30/最近点问题/" itemprop="url">
                  最近点问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-30T12:55:50+08:00" content="2016-11-30">
              2016-11-30
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>最近点对问题定义：已知上m个点的集合，找出对接近的一对点。</p>
<p>在二维空间里，可用分治法求解最近点对问题。预处理：分别根据点的x轴和y轴坐标进行排序，得到X和Y,很显然此时X和Y中的点就是S中的点。</p>
<p>情况（1）：点数小于等于三时：</p>
<p><img src="http://i.imgur.com/kyHpBOQ.png" alt=""></p>
<p>情况（2）：点数大于三时：</p>
<p>首先划分集合S为SL和SR，使得SL中的每一个点位于SR中每一个点的左边，并且SL和SR中点数相同。分别在SL和SR中解决最近点对问题，得到DL和DR，分别表示SL和SR中的最近点对的距离。令d=min(DL,DR)。如果S中的最近点对(P1,P2)。P1、P2两点一个在SL和一个在SR中，那么P1和P2一定在以L为中心的间隙内，以L-d和L+d为界，如下图所示：</p>
<p> <img src="http://i.imgur.com/qC1h3Tu.png" alt="">             </p>
<p>如果在SL中的点P和在SR中的点Q成为最近点对，那么P和Q的距离必定小于d。因此对间隙中的每一个点，在合并步骤中，只需要检验yp+d和yp-d内的点即可。</p>
<ul>
<li>步骤1：根据点的y值和x值对S中的点排序。</li>
<li>步骤2：找出中线L将S划分为SL和SR</li>
<li>步骤3：将步骤2递归的应用解决SL和SR的最近点对问题，并令d=min(dL,dR)。</li>
<li>步骤4：将L-d~L+d内的点以y值排序，对于每一个点(x1,y1)找出y值在y1-d~y1+d内的所有点，计算距离为d’。如果d’小于d，令d=d’，最后的d值就是答案。</li>
</ul>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">package cloestpoint;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.Arrays;</div><div class="line">import java.util.Collections;</div><div class="line">import java.util.Comparator;</div><div class="line"></div><div class="line">public class CloestPair &#123;</div><div class="line">	private static class Point&#123;</div><div class="line">		private double x;</div><div class="line">		private double y;</div><div class="line">		public Point()&#123;&#125;</div><div class="line">		public Point(double x,double y)&#123;this.x=x;this.y=y;&#125;	</div><div class="line">	&#125;</div><div class="line">	private static double distance(Point p1,Point p2)&#123; </div><div class="line">		return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	public static double minDistance(Point[] p,int l,int r)&#123;</div><div class="line">		if(l==r)&#123;</div><div class="line">			return Double.MAX_VALUE;</div><div class="line">		&#125;</div><div class="line">		if(l+1==r)&#123;</div><div class="line">			return distance(p[l], p[r]);</div><div class="line">		&#125;</div><div class="line">		int center=(r-l)/2;</div><div class="line">		double dis1=minDistance(p, l, center);</div><div class="line">		double dis2=minDistance(p, center+1, r);</div><div class="line">		double dis=Math.min(dis1, dis2);</div><div class="line">		ArrayList&lt;Point&gt; nearPoints = new ArrayList&lt;&gt;(); </div><div class="line">		for(Point point : p)</div><div class="line">			if(Math.abs(p[center].x-point.x)&lt;=dis)</div><div class="line">				nearPoints.add(point);</div><div class="line">		Collections.sort(nearPoints, new Comparator&lt;Point&gt;() &#123;</div><div class="line">			@Override</div><div class="line">			public int compare(Point o1, Point o2) &#123;</div><div class="line">				if(o1.y&lt;o2.y) return -1;</div><div class="line">				if(o1.y&gt;o2.y) return 1;</div><div class="line">				if(o1.x&lt;o2.x) return -1;</div><div class="line">				if(o1.x&gt;o2.x) return 1;</div><div class="line">				return 0;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">		&#125;);</div><div class="line">		ArrayList&lt;Point&gt; nearL = new ArrayList&lt;&gt;(); </div><div class="line">		ArrayList&lt;Point&gt; nearR = new ArrayList&lt;&gt;();</div><div class="line">		</div><div class="line">		for(int i=0;i&lt;nearPoints.size();i++)&#123; </div><div class="line">			if(nearPoints.get(i).x&lt;p[center].x)&#123;</div><div class="line">				nearL.add(nearPoints.get(i));</div><div class="line">			&#125;else&#123;</div><div class="line">				nearR.add(nearPoints.get(i));</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		//有问题</div><div class="line">		for(int i=0;i&lt;nearL.size();i++)&#123;</div><div class="line">			for(int j=0;j&lt;nearR.size();j++)&#123;</div><div class="line">				if(Math.abs(nearR.get(j).y-nearL.get(i).y)&lt;dis)&#123;</div><div class="line">					double d=distance(nearL.get(i), nearR.get(j));</div><div class="line">					dis=d&lt;dis?d:dis;</div><div class="line">				&#125;else&#123;</div><div class="line">					break;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		return dis;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		Point p1= new Point(-2, 1);</div><div class="line">		Point p2= new Point(-1, 3);</div><div class="line">		Point p3= new Point(1, 2);</div><div class="line">		Point p4= new Point(3, 3);</div><div class="line">		Point[] ps=&#123;p1,p2,p3,p4&#125;;</div><div class="line">		System.out.println(minDistance(ps, 0,ps.length-1 ));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/24/哈夫曼编码/" itemprop="url">
                  算法总结5-哈夫曼编码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-24T20:13:15+08:00" content="2016-11-24">
              2016-11-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h3><p>前几章的例子：dijkstra，prim，kruskal算法等</p>
<p>1.哈夫曼编码</p>
<p><img src="http://i.imgur.com/VnWxmaH.png" alt=""></p>
<p>2.算法描述</p>
<p>算法对由输组成的一个森林进行。一棵树的权等于他的树叶的频率之和。任意选取最小权的两棵树t1和t2，形成以t1和t2为子树的新树，将这样的过程进行c-1次。在算法的开始，存放c棵单节点树-每个字符一颗。在算法结束时得到一棵树，这可树就是最优哈夫曼编码树。</p>
<p><img src="http://i.imgur.com/Mpaf16W.png" alt=""></p>
<p>3.实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> hufman;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayDeque;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.PriorityQueue;</div><div class="line"><span class="keyword">import</span> java.util.Queue;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HuffmanTree</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Node</span>&lt;<span class="title">T</span>&gt;&gt;</span>&#123;</div><div class="line">		<span class="keyword">private</span> T data; <span class="comment">//节点</span></div><div class="line">		<span class="keyword">private</span> <span class="keyword">int</span> weight; <span class="comment">//权值</span></div><div class="line">		<span class="keyword">private</span> String code; <span class="comment">//编码</span></div><div class="line">		<span class="keyword">private</span> Node&lt;T&gt; left; <span class="comment">//左儿子</span></div><div class="line">		<span class="keyword">private</span> Node&lt;T&gt; right; <span class="comment">//右儿子</span></div><div class="line">		</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T data, <span class="keyword">int</span> weight)</span></span>&#123;</div><div class="line">			<span class="keyword">this</span>.data = data;  </div><div class="line">	        <span class="keyword">this</span>.weight = weight;</div><div class="line">	        <span class="keyword">this</span>.code=<span class="string">"0"</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T data,String code, <span class="keyword">int</span> weight,Node&lt;T&gt; left,Node&lt;T&gt; right)</span></span>&#123;</div><div class="line">			<span class="keyword">this</span>.data = data;  </div><div class="line">	        <span class="keyword">this</span>.weight = weight;  </div><div class="line">	        <span class="keyword">this</span>.left=left;</div><div class="line">	        <span class="keyword">this</span>.right=right;</div><div class="line">	        <span class="keyword">this</span>.code=code;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Node&lt;T&gt; o)</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.weight-o.weight;</div><div class="line">		&#125;	</div><div class="line">		<span class="meta">@Override</span>  </div><div class="line">	    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;  </div><div class="line">	        <span class="keyword">return</span> <span class="string">"data:"</span>+<span class="keyword">this</span>.data+<span class="string">" weight:"</span>+<span class="keyword">this</span>.weight+<span class="string">" code:"</span>+code+<span class="string">"\n"</span>;  </div><div class="line">	    &#125; </div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> &lt;T&gt; <span class="function">Node&lt;T&gt; <span class="title">createTree</span><span class="params">(List&lt;Node&lt;T&gt;&gt; nodes)</span></span>&#123;</div><div class="line">		Queue&lt;Node&lt;T&gt;&gt; q= <span class="keyword">new</span> PriorityQueue&lt;&gt;(nodes);</div><div class="line">		<span class="keyword">while</span>(q.size()&gt;<span class="number">1</span>)&#123;</div><div class="line">			Node&lt;T&gt; left=q.poll();</div><div class="line">			Node&lt;T&gt; right=q.poll();</div><div class="line">			Node&lt;T&gt; parent=<span class="keyword">new</span> Node&lt;T&gt;(<span class="keyword">null</span>,<span class="string">"0"</span>, left.weight+right.weight, left, right);</div><div class="line">			q.offer(parent);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> q.element();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> &lt;T&gt; List&lt;Node&lt;T&gt;&gt; breadth(Node&lt;T&gt; root)&#123;</div><div class="line">		List&lt;Node&lt;T&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Node&lt;T&gt;&gt;();  </div><div class="line">        Queue&lt;Node&lt;T&gt;&gt; queue = <span class="keyword">new</span> ArrayDeque&lt;Node&lt;T&gt;&gt;();  </div><div class="line">        <span class="keyword">if</span>(root != <span class="keyword">null</span>)&#123;  </div><div class="line">            queue.offer(root);  </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">while</span>(!queue.isEmpty())&#123;  </div><div class="line">            list.add(queue.peek());  </div><div class="line">            Node&lt;T&gt; node = queue.poll();               </div><div class="line">            <span class="keyword">if</span>(node.left!= <span class="keyword">null</span>)&#123;  </div><div class="line">                queue.offer(node.left);  </div><div class="line">                node.left.code=node.code+<span class="string">"0"</span>;</div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">if</span>(node.right!= <span class="keyword">null</span>)&#123;  </div><div class="line">                queue.offer(node.right);  </div><div class="line">                node.right.code=node.code+<span class="string">"1"</span>;</div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> list;  	</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		HuffmanTree huffmanTree = <span class="keyword">new</span> HuffmanTree();</div><div class="line">		List&lt;Node&lt;String&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Node&lt;String&gt;&gt;();  </div><div class="line">        list.add(<span class="keyword">new</span> Node&lt;String&gt;(<span class="string">"a"</span>,<span class="number">7</span>));  </div><div class="line">        list.add(<span class="keyword">new</span> Node&lt;String&gt;(<span class="string">"b"</span>,<span class="number">5</span>));  </div><div class="line">        list.add(<span class="keyword">new</span> Node&lt;String&gt;(<span class="string">"c"</span>,<span class="number">4</span>));  </div><div class="line">        list.add(<span class="keyword">new</span> Node&lt;String&gt;(<span class="string">"d"</span>,<span class="number">2</span>));</div><div class="line">        Node&lt;String&gt; root = huffmanTree.createTree(list); </div><div class="line">        System.out.println(huffmanTree.breadth(root));  </div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/21/算法总结之希尔排序/" itemprop="url">
                  算法总结2-希尔排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-21T13:50:31+08:00" content="2016-11-21">
              2016-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考：<a href="http://blog.csdn.net/morewindows/article/details/6668714" target="_blank" rel="external">http://blog.csdn.net/morewindows/article/details/6668714</a></p>
<h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><p>该方法的基本思想是：先将整个待排元素序列分割成若干个子序列（由相隔某个“增量”的元素组成的）分别进行直接插入排序，然后依次缩减增量再进行排序，待整个序列中的元素基本有序（增量足够小）时，再对全体元素进行一次直接插入排序。因为直接插入排序在元素基本有序的情况下（接近最好情况），效率是很高的，因此希尔排序在时间效率上比前两种方法有较大提高</p>
<p><img src="http://i.imgur.com/FPSyyTw.png" alt=""></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//希尔排序</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">shellsort</span><span class="params">(T[] a)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> j;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> gap=a.length/<span class="number">2</span>;gap&gt;<span class="number">0</span>;gap/=<span class="number">2</span>)&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=gap;i&lt;a.length;i++)&#123;</div><div class="line">				T tmp=a[i];</div><div class="line">				<span class="keyword">for</span>(j=i;j&gt;=gap&amp;&amp;tmp.compareTo(a[j-gap])&lt;<span class="number">0</span>;j-=gap)&#123;</div><div class="line">					a[j]=a[j-gap];</div><div class="line">				&#125;</div><div class="line">				a[j]=tmp;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/21/算法总结之插入排序/" itemprop="url">
                  算法总结1-插入排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-21T13:20:54+08:00" content="2016-11-21">
              2016-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><p>直接插入排序(Insertion Sort)的基本思想是：每次将一个待排序的记录，按其关键字大小插入到前面已经排好序的子序列中的适当位置，直到全部记录插入完成为止。</p>
<p>设数组为a[0…n-1]。</p>
<ol>
<li><p>初始时，a[0]自成1个有序区，无序区为a[1..n-1]。令i=1</p>
</li>
<li><p>将a[i]并入当前的有序区a[0…i-1]中形成a[0…i]的有序区间。</p>
</li>
<li><p>i++并重复第二步直到i==n-1。排序完成。</p>
</li>
</ol>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//插入排序</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;? <span class="keyword">super</span> T&gt;&gt; <span class="function"><span class="keyword">void</span> <span class="title">insertionSort</span><span class="params">(T[] a)</span></span>&#123;</div><div class="line">		<span class="keyword">int</span> j;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;a.length;i++)&#123;</div><div class="line">			T tmp=a[i];</div><div class="line">			<span class="keyword">for</span>(j=i;j&gt;<span class="number">0</span>&amp;&amp;tmp.compareTo(a[j-<span class="number">1</span>])&lt;<span class="number">0</span>;j--)&#123;</div><div class="line">				a[j]=a[j-<span class="number">1</span>];</div><div class="line">			&#125;</div><div class="line">			a[j]=tmp;</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/21/算法总结之快速排序/" itemprop="url">
                  算法总结4-快速排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-21T12:24:37+08:00" content="2016-11-21">
              2016-11-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考：<a href="http://blog.csdn.net/morewindows/article/details/6684558" target="_blank" rel="external">http://blog.csdn.net/morewindows/article/details/6684558</a></p>
<h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><p>快速排序是C.R.A.Hoare于1962年提出的一种划分交换排序。它采用了一种分治的策略，通常称其为分治法(Divide-and-ConquerMethod)。</p>
<p>该方法的基本思想是：</p>
<p>1．先从数列中取出一个数作为基准数。</p>
<p>2．分区过程，将比这个数大的数全放到它的右边，小于或等于它的数全放到它的左边。</p>
<p>3．再对左右区间重复第二步，直到各区间只有一个数</p>
<p>虽然快速排序称为分治法，但分治法这三个字显然无法很好的概括快速排序的全部步骤。因此我的对快速排序作了进一步的说明：<strong>挖坑填数+分治法</strong>：</p>
<p><img src="http://i.imgur.com/lXST5qW.png" alt=""></p>
<p><img src="http://i.imgur.com/6GAncK6.png" alt=""></p>
<p>对挖坑填数进行总结</p>
<p>1．i =L; j = R; 将基准数挖出形成第一个坑a[i]。</p>
<p>2．j–由后向前找比它小的数，找到后挖出此数填前一个坑a[i]中。</p>
<p>3．i++由前向后找比它大的数，找到后也挖出此数填到前一个坑a[j]中。</p>
<p>4．再重复执行2，3二步，直到i==j，将基准数填入a[i]中。</p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> sort;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 快排</div><div class="line"> * <span class="doctag">@author</span> neuly</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] swap(<span class="keyword">int</span>[] s, <span class="keyword">int</span> l,<span class="keyword">int</span> r)&#123;</div><div class="line">		<span class="comment">//将中间的数和第一个数进行交换</span></div><div class="line">		<span class="keyword">int</span> tmp=s[l];</div><div class="line">		s[l]=s[(r-l)/<span class="number">2</span>];</div><div class="line">		s[(r-l)/<span class="number">2</span>]=tmp;</div><div class="line">		<span class="keyword">return</span> s;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] s, <span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(l&lt;r)&#123;	</div><div class="line">			<span class="keyword">int</span> i=l,j=r,x=s[l];</div><div class="line">			<span class="keyword">while</span>(i&lt;j)&#123;</div><div class="line">				<span class="keyword">while</span>(i&lt;j&amp;&amp;s[j]&gt;=x) j--;</div><div class="line">				<span class="keyword">if</span>(i&lt;j) s[i++]=s[j];</div><div class="line">				</div><div class="line">				<span class="keyword">while</span>(i&lt;j&amp;&amp;s[i]&lt;=x) i++;</div><div class="line">				<span class="keyword">if</span>(i&lt;j) s[j--]=s[i];</div><div class="line">			&#125;</div><div class="line">			s[i]=x;</div><div class="line">			quickSort(s, l, i-<span class="number">1</span>);</div><div class="line">			quickSort(s, i+<span class="number">1</span>, r);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/20/datastructs/" itemprop="url">
                  datastructs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-20T13:10:58+08:00" content="2016-11-20">
              2016-11-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/datastructure/" itemprop="url" rel="index">
                    <span itemprop="name">datastructure</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h3><p>1.数组实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> datastructure;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.NoSuchElementException;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> default_capacity=<span class="number">16</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size;</div><div class="line">	<span class="keyword">private</span> T[] items;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">()</span> </span>&#123;</div><div class="line">		clear();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</div><div class="line">		size=<span class="number">0</span>;</div><div class="line">		ensureCapacity(default_capacity);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> size;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> size()==<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trimToSize</span><span class="params">()</span></span>&#123;</div><div class="line">		ensureCapacity(size());</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(idx&lt;<span class="number">0</span>||idx&gt;=size())&#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> items[idx];</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,T newVal)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(idx&lt;<span class="number">0</span>||idx&gt;=size())&#123;</div><div class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException();</div><div class="line">		&#125;</div><div class="line">		T old =items[idx];</div><div class="line">		items[idx]=newVal;</div><div class="line">		<span class="keyword">return</span> old;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T x)</span></span>&#123;</div><div class="line">		add(size(),x);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> idx,T x)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(items.length==size())&#123;</div><div class="line">			ensureCapacity(size()*<span class="number">2</span>+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=size;i&gt;idx;i--)&#123;</div><div class="line">			items[i]=items[i-<span class="number">1</span>];</div><div class="line">		&#125;</div><div class="line">		items[idx]=x;</div><div class="line">		size++;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">remove</span> <span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</div><div class="line">		T removedItem=items[idx];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=idx;i&lt;size()-<span class="number">1</span>;i++)&#123;</div><div class="line">			items[i]=items[i+<span class="number">1</span>];</div><div class="line">		&#125;</div><div class="line">		size--;</div><div class="line">		<span class="keyword">return</span> removedItem;		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> newCapacity)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(newCapacity&lt;size) <span class="keyword">return</span>;</div><div class="line">		T[] old=items;</div><div class="line">		items= (T[]) <span class="keyword">new</span> Object[newCapacity];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;size();i++)&#123;</div><div class="line">			items[i]=old[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ArrayListIterator();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">private</span> <span class="keyword">int</span> current=<span class="number">0</span>;</div><div class="line">		</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> current&lt;size();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span>(!hasNext())</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</div><div class="line">			<span class="keyword">return</span> items[current++];</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</div><div class="line">			MyArrayList.<span class="keyword">this</span>.remove(--current);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.node实现linkedlist</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> datastructure;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ConcurrentModificationException;</div><div class="line"><span class="keyword">import</span> java.util.Iterator;</div><div class="line"><span class="keyword">import</span> java.util.NoSuchElementException;</div><div class="line"><span class="keyword">import</span> java.util.Stack;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLinkedList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> modCount=<span class="number">0</span>;</div><div class="line">	<span class="keyword">private</span> Node&lt;T&gt; beginMarker;</div><div class="line">	<span class="keyword">private</span> Node&lt;T&gt; endMarker;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line">		<span class="keyword">public</span> T data;</div><div class="line">		<span class="keyword">public</span> Node&lt;T&gt; prev;</div><div class="line">		<span class="keyword">public</span> Node&lt;T&gt; next;		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(T d,Node&lt;T&gt; p, Node&lt;T&gt; n)</span></span>&#123;</div><div class="line">			data=d;</div><div class="line">			prev=p;</div><div class="line">			next=n;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span>  <span class="title">MyLinkedList</span><span class="params">()</span> </span>&#123;</div><div class="line">		clear();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</div><div class="line">		beginMarker= <span class="keyword">new</span> Node&lt;T&gt;(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">		endMarker= <span class="keyword">new</span> Node&lt;T&gt;(<span class="keyword">null</span>, beginMarker, <span class="keyword">null</span>);</div><div class="line">		beginMarker.next=endMarker;</div><div class="line">		size=<span class="number">0</span>;</div><div class="line">		modCount++;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> size;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> size()==<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(T x)</span></span>&#123;</div><div class="line">		add(size(),x);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> idx,T x)</span></span>&#123;</div><div class="line">		addBefore(getNode(idx),x);		</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> getNode(idx).data;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> idx,T newVal)</span></span>&#123;</div><div class="line">		Node&lt;T&gt; p =getNode(idx);</div><div class="line">		T oldVal=p.data;</div><div class="line">		p.data=newVal;</div><div class="line">		<span class="keyword">return</span> oldVal;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> remove(getNode(idx));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(T x)</span></span>&#123;</div><div class="line">		Node&lt;T&gt; p =beginMarker.next;</div><div class="line">		<span class="keyword">while</span>(p!=endMarker&amp;&amp;!(p.data.equals(x)))&#123;</div><div class="line">			p=p.next;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> p!=endMarker;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addBefore</span><span class="params">(Node&lt;T&gt; p, T x)</span></span>&#123;</div><div class="line">		Node&lt;T&gt; newNode= <span class="keyword">new</span> Node&lt;T&gt;(x, p.prev, p);</div><div class="line">		newNode.prev.next=newNode;		</div><div class="line">		p.prev=newNode;</div><div class="line">		size++;</div><div class="line">		modCount++;			</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> T <span class="title">remove</span><span class="params">(Node&lt;T&gt; p)</span></span>&#123;</div><div class="line">		p.prev.next=p.next;</div><div class="line">		p.next.prev=p.prev;</div><div class="line">		size--;</div><div class="line">		modCount++;</div><div class="line">		<span class="keyword">return</span> p.data;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> Node&lt;T&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> idx)</span></span>&#123;</div><div class="line">		Node&lt;T&gt; p;</div><div class="line">		<span class="keyword">if</span>(idx&lt;<span class="number">0</span>||idx&gt;size()) <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</div><div class="line">		<span class="keyword">if</span>(idx&lt;size()/<span class="number">2</span>)&#123;</div><div class="line">			p=beginMarker.next;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;idx;i++) p=p.next;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			p=endMarker;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=size();i&gt;idx;i--) p=p.prev;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> p;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> linkedListIterator();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">linkedListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">private</span> Node&lt;T&gt; current =beginMarker.next;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">int</span> exceptedModCount=modCount;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">boolean</span> okToRemove=<span class="keyword">false</span>;</div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;			</div><div class="line">			<span class="keyword">return</span> current!=endMarker;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span>(modCount!=exceptedModCount) <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</div><div class="line">			<span class="keyword">if</span>(!hasNext()) <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</div><div class="line">			T nextItem =current.data;</div><div class="line">			current=current.next;</div><div class="line">			okToRemove=<span class="keyword">true</span>;</div><div class="line">			<span class="keyword">return</span> nextItem;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>&#123;</div><div class="line">			<span class="keyword">if</span>(modCount!=exceptedModCount) <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</div><div class="line">			<span class="keyword">if</span>(!okToRemove) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</div><div class="line">			MyLinkedList.<span class="keyword">this</span>.remove(current.prev);</div><div class="line">			okToRemove=<span class="keyword">false</span>;</div><div class="line">			exceptedModCount++;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><h3 id="树"><a href="#树" class="headerlink" title="树"></a>树</h3><h3 id="散列"><a href="#散列" class="headerlink" title="散列"></a>散列</h3><h3 id="优先队列（堆）"><a href="#优先队列（堆）" class="headerlink" title="优先队列（堆）"></a>优先队列（堆）</h3><p>堆是一棵完全被填满的二叉树。<br>一棵高位h的完全二叉树有2^k到2^（k+1）-1个节点。</p>
<p>完全二叉树可以用一个数组表示。</p>
<p>对于数组中i位置上的元素，做儿子在2i，右儿子在2i+1，父亲在[i/2]</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/16/深入理解jvm十-早期（编译期）优化/" itemprop="url">
                  深入理解jvm十-早期（编译期）优化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-16T13:37:45+08:00" content="2016-11-16">
              2016-11-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-编译期"><a href="#1-编译期" class="headerlink" title="1.编译期"></a>1.编译期</h3><ul>
<li>前端编译器：把<em>java转换成</em>.class文件的过程。 <ul>
<li>sun的javac eclipsejdt中的ecj</li>
</ul>
</li>
<li>后端运行时编译器（JIT just in time）：字节码转换为机器码的过程<ul>
<li>hotspot vm 中的 c1 c2编译器</li>
</ul>
</li>
<li>静态提前编译器（AOT ahead of time）：把.java编译成本地机器码的过程。<ul>
<li>gun compiler for java</li>
</ul>
</li>
</ul>
<p>ps：java中编译期在运行期的优化过程对于程序运行来说更重要，二前端编译期在编译期的优化过程对于<strong>程序编码</strong>来说更重要。</p>
<h3 id="2-javac编译器"><a href="#2-javac编译器" class="headerlink" title="2.javac编译器"></a>2.javac编译器</h3><p>从 Sun Javac 的代码来看，编译过程大致可以分为 3 个过程，分别是：</p>
<ul>
<li>解析与填充符号表过程。</li>
<li>插入式注解处理器的注解处理过程。</li>
<li>分析与字节码生成过程。</li>
</ul>
<p>详细内容参考blog<a href="http://blog.csdn.net/u013678930/article/details/52032328" target="_blank" rel="external">http://blog.csdn.net/u013678930/article/details/52032328</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/12/面向对象设计与分析复习note/" itemprop="url">
                  面向对象设计与分析复习note
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-11-12T18:28:24+08:00" content="2016-11-12">
              2016-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="概念1"><a href="#概念1" class="headerlink" title="概念1"></a>概念1</h3><p>面向对象分析：<br>在<strong>问题域内</strong>发现和描述<strong>对象</strong>。</p>
<p>面向对象设计：<br>强调的是定义<strong>软件对象</strong>以他们是如何<strong>协作</strong>以实现<strong>需求</strong>。</p>
<p>面向对象的优点:</p>
<ul>
<li>复用<br>通过继承、关联、封装等手段</li>
<li>应变<br>弹性应对需求变化</li>
<li>沟通<br>开发人员、用户、管理人员</li>
<li>市场<br>应付市场的变化</li>
<li>士气<br>员工的士气</li>
</ul>
<p>系统顺序图(SSD):</p>
<ul>
<li>系统顺序图(SSD)是阐述与<strong>所讨论系统</strong>相关的输入和输出事件而快速、简单创建的制品（顺序图）。 </li>
<li>对于用例的一个特定场景，SSD展示了直接与系统交互的<strong>外部参与者</strong>对<strong>系统</strong>（作为黑盒）发起的<strong>系统事件</strong>以及其（系统事件）<strong>顺序</strong>。</li>
<li>系统被视为<strong>黑盒</strong>，该图强调的是从参与者到系统的跨越系统边界的事件。</li>
<li>系统顺序图是操作契约（第11章）和（最重要的）对象设计的输入。</li>
</ul>
<h3 id="2-基于用例图、类图、顺序图的分析与设计"><a href="#2-基于用例图、类图、顺序图的分析与设计" class="headerlink" title="2.基于用例图、类图、顺序图的分析与设计"></a>2.基于用例图、类图、顺序图的分析与设计</h3><p><strong>用例图：</strong></p>
<p>actor（有行为的something)<br>:在系统之外，通过系统边界与系统进行有意义交互的任何事物<br>:actor is something with behavior, such as a person (identified by role), computer system, or organization; for example, a cashier.</p>
<p>scenario: 一个场景是一种特定序列的在参与者和系统之间的动作。也被乘坐use case instance<br>:A scenario is a specific sequence of actions and interactions between actors and the system; it is also called a use case instance. </p>
<p>use case: 用例是一组成功或失败的场景，用以描述使用系统来达到某个<br>目的的参与者。<br>A use case is a collection of related success and failure scenarios that describe an actor using a system to support a goal</p>
<p>三种关系：</p>
<ul>
<li>包含：提取公共交互，提高复用</li>
<li>扩展：“冻结”基础用例以保持稳定</li>
<li>泛化：同一业务目的的不同技术实现</li>
</ul>
<p>ps：使用包含关系来处理用例之间的关系是首要原则</p>
<p><strong>顺序图：</strong></p>
<p>显示一组对象为了实现某种功能，而彼此发送和接收的一串消息，这组对象可能是类、接口、构件、节点和系统的具体的或原型化的实例。<br>强调消息时间顺序</p>
<p>note:<br>刺形箭头消息表示异步调用，实心箭头消息表示同步调用</p>
<ul>
<li>消息的传入：类对象所具有的操作－－责任（行为）</li>
<li>消息的传出：类对象完成操作所需合作者－－协作</li>
</ul>
<p>bce模式</p>
<p><strong>类图：</strong></p>
<ul>
<li>分析类——域模型<ul>
<li>关键抽象，CRC较验</li>
<li>类图，关键确定类之间关系</li>
</ul>
</li>
<li>设计类——<ul>
<li>设计类是系统实施中一个或多个对象的抽象；设计类所对应的对象取决于采用的系统框架、设计模式、实现语言。 </li>
</ul>
</li>
</ul>
<p>分析类图-域模型<br><img src="http://i.imgur.com/XlKHtHM.png" alt=""></p>
<p>类之间的关系</p>
<p><img src="http://i.imgur.com/vZ0NiPF.png" alt=""></p>
<p>依赖关系表示的是类之间的调用关系，即用一个类去调用另外一个类，被调用的类表现为调用类的局部变量、方法的参数，调用类调用被调用类的静态方法。–&gt;</p>
<p><strong>依赖vs关联</strong></p>
<ul>
<li>从类之间关系的时间角度来分，关联表示类之间的“持久、静态”关系，一般需要“持久化”的，或者说需要保存到数据库中的，是一种重要的业务之间的关系。另外，依赖表示类之间的是一种“短暂、动态”关系，这种关系是不需要保存的。</li>
<li>从类之间关系的强弱程度来分，关联表示类之间的很强的关系；依赖表示类之间的较弱的关系。</li>
<li>设计类之间的关系遵循的原则：首先判断是否是一种“关联”关系，若不是再判断是否是“依赖关系”，一般情况下若不是关联，就是依赖关系</li>
<li>依赖关系（Dependency relationship ）：是类与类之间的连接，依赖总是单向的。</li>
<li>关联关系（Association relationship）：是一种结构关系，是指一个类的对象与另一个类的对象之间的关系（具有多重性）。关联可以有方向，即导航。一般不作说明的时候，导航是双向的，不需要在线上标出箭头。关联在代码中一般表示为属性（成员变量）</li>
</ul>
<h3 id="3-鲁棒性分析"><a href="#3-鲁棒性分析" class="headerlink" title="3.鲁棒性分析"></a>3.鲁棒性分析</h3><p>定义：</p>
<ul>
<li>一种方法<ul>
<li>通过分析用例规约中的事件流，识别出实现用例规定的功能所需的主要对象及其职责，形成以职责模型为主的初步设计。——由Ivar Jacobson提出。</li>
</ul>
</li>
<li>一个过程<ul>
<li>它引导我们从用例转换为支持用例的模型。</li>
</ul>
</li>
</ul>
<p>鲁棒图：<br>包含三种元素：边界对象，控制对象，实体对象。</p>
<p>建模原则：</p>
<blockquote>
<p>(1) 参与者只能与边界对象交谈<br>(2) 边界对象只能与控制体和参与者交流<br>(3) 实体对象也只能与控制体交谈<br>(4) 控制体既能与边界对象交谈，也能与控制体交谈，但不能与参与者交谈</p>
</blockquote>
<h3 id="4-面向对象设计原则"><a href="#4-面向对象设计原则" class="headerlink" title="4.面向对象设计原则"></a>4.面向对象设计原则</h3><p>好的设计：</p>
<ul>
<li>容易理解</li>
<li>容易修改和扩展</li>
<li>容易复用</li>
<li>容易实现与应用</li>
<li>简单、紧凑、经济适用</li>
</ul>
<p>坏的设计：</p>
<ul>
<li>僵化性（Rigidity）：刚性，难以修改，牵一发而动全身</li>
<li>脆弱性（Fragility）：易碎，牵一发而肝胆俱裂</li>
<li>牢固性（Immobility）：无法分解成可移植的组件</li>
<li>粘滞性（Viscosity），修改设计代价高昂</li>
<li>不必要的复杂性（Needless Complexity）,预测需求，处理潜在变化代码</li>
<li>不必要的重复（ Needless Repetition ）</li>
<li>晦涩性（Opacity）：不透明，很难看清设计者的真实意图</li>
</ul>
<p>原则：</p>
<ul>
<li>LSP：Liskov替换原则<br>The Liskov Substitution Principle</li>
<li>OCP：开放-封闭原则<br>The Open-Close Principle</li>
<li>SRP：单一职责原则<br>The Single Responsibility Principle</li>
<li>ISP：接口隔离原则<br>The Interface Segregation Principle </li>
<li>DIP：依赖倒置原则<br>The Dependency Inversion Principle</li>
</ul>
<h3 id="5-GRASP：通用职责分配软件模式"><a href="#5-GRASP：通用职责分配软件模式" class="headerlink" title="5.GRASP：通用职责分配软件模式"></a>5.GRASP：通用职责分配软件模式</h3><p>General Responsibility Assignment Software Pattern:     GRASP 作为设计模式来描述对象设计和职责分配的基本原则。</p>
<p>GRASP模式：</p>
<ul>
<li>创建者(Creator)</li>
<li>信息专家(Information Expert)</li>
<li>低耦合(Low Coupling)</li>
<li>控制器(Controller)</li>
<li>高内聚(High Cohesion)</li>
<li>多态（Polymorphism）</li>
<li>纯虚构（Pure Fabrication）</li>
<li>间接性（Indirection）</li>
<li>防止变异（Protected Variations）</li>
</ul>
<p>信息专家：将职责分配给具有完成该职责所需信息的那个类</p>
<p>低耦合：分配职责，使耦合尽可能低。利用这一原则来评估可选方案。</p>
<p>高内聚度：不要给一个类分派太多的职责，在履行职责时尽量将部分职责分派给有能力完成的其它类去完成。不相关的职责不要分派给同一个类。</p>
<p>控制器：正常情况下，控制器应当把需要完成的工作委派给其它对象。控制器只是协调或控制这些活动，本身并不完成大量工作。</p>
<p>多态：当相关的或行为随类型（类）有所不同时，使用“多态操作”为变化的行为类型分配职责 。</p>
<p>纯虚构：分配这组高度内聚的职责给一个人造类。人造类不代表问题领域的任何事物，只是为了支持高内聚、低耦合和可重用而虚构的一个类。</p>
<p>适配器与某些grasp核心原则的关系<br><img src="http://i.imgur.com/EYjjYlR.png" alt=""></p>
<h3 id="6-设计模式"><a href="#6-设计模式" class="headerlink" title="6.设计模式"></a>6.设计模式</h3><p>creational </p>
<p>behavioral</p>
<p>structural</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Loren" />
          <p class="site-author-name" itemprop="name">Loren</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">55</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">Kategorien</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Loren</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script>

  
  <script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  

  

  

  

  


</body>
</html>
